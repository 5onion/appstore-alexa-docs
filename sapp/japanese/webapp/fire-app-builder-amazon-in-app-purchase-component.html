<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Amazonアプリ内課金のコンポーネント | Fire App Builder</title>
    <base target="_self">
    <meta name="description" content="Amazonアプリ内課金コンポーネントでは、Amazonのアプリ内課金 (IAP) APIを使用して、アプリに次の 2 つの購入オプションを組み込みます。  Daily Pass: ユーザーは 1 日間 (購入時から 24 時間) アプリ内のメディアを視聴できます。これは 24 時間見放題の映画レンタルに似たオプションです。* Go Premium: ユーザーは定期購読料を払って購読期間中にアプリ内のすべてのメディアを視聴できます。購読期間は開発者がAmazon開発者コンソールでアプリ内アイテムを設定する際に定義します。  アプリ内課金コンポーネントを使用すると、ユーザートランザクションの処理を気にする必要がありません。ユーザーはAmazonアカウントを通じて購入を行います。このアカウントはユーザーがFire TVを設定する際にセットアップします。アプリ内のトランザクションの詳細はアプリ内課金APIによって処理されます。 ... " />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" value="notranslate">
    <link rel="icon"  type="image/x-icon" href="favicon.ico">


    <!-- Load sidebar component -->
    <link rel="stylesheet" type="text/css" href="assets/css/font-awesome.min.css">
    <script type="text/javascript" src="assets/js/jquery.min.js"></script>
    <!-- Load jquery.cookie plugin (optional) -->
    <script type="text/javascript" src="assets/js/jquery.cookie.min.js"></script>
    <!-- Load jquery.navgoco plugin js and css files -->
    <script type="text/javascript" src="assets/js/jquery.navgoco.min.js"></script>

    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/toc.js"></script>
    <script src="assets/js/anchor.min.js"></script>



    <script>
        $( document ).ready(function() {
            $("#docnavsidebar").navgoco({
                caretHtml: '',
                accordion: false,
                openClass: 'open', // open
                save: true,
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 300,
                    easing: 'swing'
                }
            });
            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#docnavsidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#docnavsidebar").navgoco('toggle', true);
            });
        });

    </script>
    <script src="assets/js/customscripts.js"></script>

    <script>
        $(document).ready(function() {
            $('[data-toggle=offcanvas]').click(function() {
                $('.row-offcanvas').toggleClass('active');
            });
        });
    </script>


    <!--stylesheets / link tags loaded here-->

    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />

    <link rel="stylesheet" href="assets/css/main.css" />
    <style>
        ul#markdown-toc::before  {
        content: "目次"
         }
    </style>

</head>
<body class="default">
<div class="page-container">


    <!-- Top Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container topnavlinks">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle topnav</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <button type="button" class="navbar-toggle toggle-sidebar-button"  data-toggle="offcanvas" data-target=".sidebar-nav">
                    <span class="sr-only">Toggle sidebar</span>
                    <span class="sidebarToggle fa fa-columns fa-2x"></span>
                </button>

                <a class="navbar-brand noCrossRef" href="/">
                    <img class="navbar-logo" src="amazonlogowhite.png"/>
            </div>

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-left">

                    <!-- single item nav items appear here -->

                    
                    
                    
                    
                    <li><a href="https://developer.amazon.com/support" class="noCrossRef">サポート</a></li>
                    
                    
                    
                    <li><a href="https://developer.amazon.com/blogs" class="noCrossRef">ブログ</a></li>
                    
                    
                    

                    <!-- drop-down nav items appear here -->

                    



                </ul>

                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <!--start search -->
                        <!--
                        <div id="search-demo-container">
                            <form action="search.html" method="get">
                                <input type="text" id="search-input" placeholder="グローバル検索 ..." name="query">
                            </form>
                        </div>
                        -->
                        <!-- end search-->
                    </li>
                </ul>
            </div>

        </div>

        <!--<div class="navbarbottom">-->
        <!--<div class="container">-->
        <!--

-->
        <!--</div>-->
        <!--</div>-->
        <!-- /.container -->
    </nav>


<div class="container">
        <div class="row row-offcanvas row-offcanvas-left">

            <!-- sidebar -->
            <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">

                


<div class="mydocsidebar">
<div class="sidebar-inner">
<!-- search bar -->

<div class="sidebarSearchBar">
<form action="search-fireappbuilder_ja.html" method="get">
  <div class="input-group search">
    <input type="text" id="search-box" name="query" class="form-control" placeholder="製品検索 ...">
    <div class="input-group-btn">
      <button class="btn btn-default" type="submit" value="search">
        <i class="glyphicon glyphicon-search"></i>
      </button>
    </div>
  </div>
</form>
</div>

<!-- end search bar -->


<div class="productTitle">Fire App Builder</div>
<p class="external">
    <a href="#" id="collapseAll">すべてを折りたたむ</a> | <a href="#" id="expandAll">すべて展開</a>
</p>



    <ul id="docnavsidebar" class="docnav">
    
    <li class="level1"><a href="#">Introduction</a>
        <ul>
            

            
            
            <li class="level1items"><a href="fire-app-builder-overview.html">Fire App Builder: JavaベースのAmazon Fire TVおよびAndroidアプリ向けスターターキット</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-release-notes.html">リリースノート</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-end-to-end-process.html">アプリを作成するための一連のプロセス</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-questions-and-answers.html">よくある質問</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">1. Get Set Up</a>
        <ul>
            

            
            
            <li class="level1items"><a href="fire-app-builder-download-and-build.html">Fire App Builderをダウンロードして、アプリをビルドする</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-connecting-adb-to-fire-tv.html">ADBを使用してFire TVに接続する</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-app-tour.html">アプリの概要</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">2. Configure Your Feed</a>
        <ul>
            

            
            
            <li class="level1items"><a href="fire-app-builder-load-media-feed.html">メディアフィードをロードする</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-set-up-recipes-overview.html">レシピ構成の概要</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-set-up-recipes-categories.html">カテゴリレシピをセットアップする</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-set-up-recipes-content.html">コンテンツレシピをセットアップする</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-configure-navigator.html">Navigatorの構成の概要</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-configure-navigator-token-feeds.html">Navigatorの構成 -- トークンベースフィード</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-configure-navigator-open-feeds.html">Navigatorの構成 -- オープンフィード</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">3. Customize the Appearance</a>
        <ul>
            

            
            
            <li class="level1items"><a href="fire-app-builder-customize-look-and-feel.html">アプリのルックアンドフィールをカスタマイズする</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">4. Add Components</a>
        <ul>
            

            
            
            <li class="level1items"><a href="fire-app-builder-interfaces-and-components.html">コンポーネントの概要</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-load-a-component.html">アプリにコンポーネントをロードする</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-create-a-new-component.html">新しいFire App Builderコンポーネントを作成する</a></li>
            
            

            

            <li class="level2"><a class="subfoldersTitle" href="#">Ads components</a>
                <ul style="display:none;">
                    

                    
                    
                    <li class="level2items"><a href="fire-app-builder-freewheel-ads-component.html">Freewheel広告コンポーネント</a></li>
                    
                    

                    

                    

                    
                    
                    <li class="level2items"><a href="fire-app-builder-vast-ads-component.html">VAST広告コンポーネント</a></li>
                    
                    

                    

                    
                </ul>
            </li>

            

            <li class="level2"><a class="subfoldersTitle" href="#">Analytics components</a>
                <ul style="display:none;">
                    

                    
                    
                    <li class="level2items"><a href="fire-app-builder-crashlytics-component.html">Crashlyticsコンポーネント</a></li>
                    
                    

                    

                    

                    
                    
                    <li class="level2items"><a href="fire-app-builder-flurry-analytics-component.html">Flurry Analyticsコンポーネント</a></li>
                    
                    

                    

                    

                    
                    
                    <li class="level2items"><a href="fire-app-builder-google-analytics-component.html">Googleアナリティクスコンポーネント</a></li>
                    
                    

                    

                    

                    
                    
                    <li class="level2items"><a href="fire-app-builder-omniture-analytics-component.html">Omniture Analyticsコンポーネント</a></li>
                    
                    

                    

                    
                </ul>
            </li>

            

            <li class="level2"><a class="subfoldersTitle" href="#">Authorization components</a>
                <ul style="display:none;">
                    

                    
                    
                    <li class="level2items"><a href="fire-app-builder-adobe-pass-auth-component.html">Adobe Pass認証コンポーネント</a></li>
                    
                    

                    

                    

                    
                    
                    <li class="level2items"><a href="fire-app-builder-facebook-auth-component.html">Facebook認証コンポーネント</a></li>
                    
                    

                    

                    

                    
                    
                    <li class="level2items"><a href="fire-app-builder-login-with-amazon-component.html">Login with Amazonコンポーネント</a></li>
                    
                    

                    

                    
                </ul>
            </li>

            

            <li class="level2"><a class="subfoldersTitle" href="#">Purchasing components</a>
                <ul style="display:none;">
                    

                    
                    
                    <li class="level2items open"><a href="fire-app-builder-amazon-in-app-purchase-component.html">Amazonアプリ内課金のコンポーネント</a></li>
                    
                    

                    

                    
                </ul>
            </li>

            

            <li class="level2"><a class="subfoldersTitle" href="#">Media components</a>
                <ul style="display:none;">
                    

                    
                    
                    <li class="level2items"><a href="fire-app-builder-amazon-media-player-component.html">Amazon Media Playerコンポーネント</a></li>
                    
                    

                    

                    
                </ul>
            </li>

            

            
        </ul>

        
    <li class="level1"><a href="#">Other Development Topics</a>
        <ul>
            

            
            
            <li class="level1items"><a href="fire-app-builder-pulling-updates-from-github.html">Githubから更新データをプルする</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-live-stream-configuration.html">ライブストリーミングを構成する</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-catalog-integration.html">Fire TVカタログにメディアを組み込む</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-use-an-android-tv-emulator.html">Android TVエミュレーターを使用してアプリを実行する</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-querying-json.html">JSONでクエリを実行する</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-querying-xml.html">XMLでクエリを実行する</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="fire-app-builder-troubleshooting.html">トラブルシューティング</a></li>
            
            

            

            
        </ul>

        

    </li>
</ul>

<hr class="resourceSeparator"></hr>
<div class="relatedResources">その他のリソース</div>
<ul id="entrypages">
        
        <li><a class="noCrossRef" href="/getting-started-developing-apps-and-games-for-amazon-fire-tv.html">Fire TV</a></li>
        
    </li>
</ul>
</div>
</div>
<script>$("li.open").parents('li').toggleClass("open");</script>






            </div>

            <!-- main area -->
            <div class="col-xs-12 col-sm-9 main">
                
                    <div class="subtitle"><a href="http://developer.amazon.com" class="noCrossRef productSubtitle"> 自宅</a> > <a href="index.html" class="noCrossRef productSubtitle"> ドキュメンテーション</a> > Fire App Builder > </div>
                    <h1>Amazonアプリ内課金のコンポーネント</h1>

                    

                    <p>Amazonアプリ内課金コンポーネントでは、Amazonの<a href="https://developer.amazon.com/public/apis/earn/in-app-purchasing">アプリ内課金</a> (IAP) APIを使用して、アプリに次の 2 つの購入オプションを組み込みます。</p>

<ul>
  <li><strong>Daily Pass</strong>: ユーザーは 1 日間 (購入時から 24 時間) アプリ内のメディアを視聴できます。これは 24 時間見放題の映画レンタルに似たオプションです。* <strong>Go Premium</strong>: ユーザーは定期購読料を払って購読期間中にアプリ内のすべてのメディアを視聴できます。購読期間は開発者がAmazon開発者コンソールでアプリ内アイテムを設定する際に定義します。</li>
</ul>

<p>アプリ内課金コンポーネントを使用すると、ユーザートランザクションの処理を気にする必要がありません。ユーザーはAmazonアカウントを通じて購入を行います。このアカウントはユーザーがFire TVを設定する際にセットアップします。アプリ内のトランザクションの詳細はアプリ内課金APIによって処理されます。</p>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> “Daily Pass” または “Go Premium” と表示されるボタンテキストをカスタマイズできます。UI文字列をカスタマイズする方法の詳細については、「<a href="#buttontext">ボタンテキストをカスタマイズする</a>」を参照してください。</div>

<ul id="markdown-toc">
  <li><a href="#amazonアプリ内課金コンポーネントのユーザーエクスペリエンス" id="markdown-toc-amazonアプリ内課金コンポーネントのユーザーエクスペリエンス">Amazonアプリ内課金コンポーネントのユーザーエクスペリエンス</a></li>
  <li><a href="#アプリ内課金に関する注意事項と制限事項" id="markdown-toc-アプリ内課金に関する注意事項と制限事項">アプリ内課金に関する注意事項と制限事項</a></li>
  <li><a href="#amazonアプリ内課金コンポーネントのワークフロー" id="markdown-toc-amazonアプリ内課金コンポーネントのワークフロー">Amazonアプリ内課金コンポーネントのワークフロー</a></li>
  <li><a href="#構成の概要" id="markdown-toc-構成の概要">構成の概要</a>    <ul>
      <li><a href="#daily-pass-消耗品-とgo-premium-定期購読" id="markdown-toc-daily-pass-消耗品-とgo-premium-定期購読">Daily Pass (消耗品) とGo Premium (定期購読)</a></li>
      <li><a href="#amazonアプリ内課金コンポーネントの構成" id="markdown-toc-amazonアプリ内課金コンポーネントの構成">Amazonアプリ内課金コンポーネントの構成</a></li>
    </ul>
  </li>
  <li><a href="#createapp" id="markdown-toc-createapp">手順 1. 開発者ポータルでアプリを作成する</a></li>
  <li><a href="#creategopassitem" id="markdown-toc-creategopassitem">手順 2. 消耗品 (Daily Pass) アプリ内アイテムを作成する</a></li>
  <li><a href="#creategopremiumitem" id="markdown-toc-creategopremiumitem">手順 3. 定期購読 (Go Premium) アプリ内アイテムを作成する</a></li>
  <li><a href="#downloadjson" id="markdown-toc-downloadjson">手順 4.JSONデータファイルをダウンロードしてプッシュする</a></li>
  <li><a href="#enableiap" id="markdown-toc-enableiap">手順 5. アプリでアプリ内課金コンポーネントを有効にする</a></li>
  <li><a href="#mapinappitems" id="markdown-toc-mapinappitems">手順 6. アプリでアプリ内アイテムをコンテンツにマップする</a></li>
  <li><a href="#buttontext" id="markdown-toc-buttontext">手順 7.ボタンテキストをカスタマイズする</a></li>
  <li><a href="#apptester" id="markdown-toc-apptester">手順 8.App Testerを設定する</a>    <ul>
      <li><a href="#呼び出しをシミュレートする" id="markdown-toc-呼び出しをシミュレートする">呼び出しをシミュレートする</a></li>
      <li><a href="#アプリ内アイテムを調整する" id="markdown-toc-アプリ内アイテムを調整する">アプリ内アイテムを調整する</a></li>
      <li><a href="#購入情報をリセットする" id="markdown-toc-購入情報をリセットする">購入情報をリセットする</a></li>
    </ul>
  </li>
  <li><a href="#additionalsecurity" id="markdown-toc-additionalsecurity">Receipt Verification Serviceを使用したセキュリティの強化</a></li>
  <li><a href="#アプリ内アイテムを本番環境に申請する" id="markdown-toc-アプリ内アイテムを本番環境に申請する">アプリ内アイテムを本番環境に申請する</a></li>
</ul>

<h2 id="amazonアプリ内課金コンポーネントのユーザーエクスペリエンス">Amazonアプリ内課金コンポーネントのユーザーエクスペリエンス</h2>

<p>Amazonアプリ内課金コンポーネントをアプリに実装すると、ユーザーには [Content Details] 画面に ([Watch Now] ボタンの代わりに) [Daily Pass] ボタンと [Go Premium] ボタンが表示されます。</p>

<figure><img class="docimage " src="docs_ja/firetv/fireappbuilder/images/fireappbuilder_iapprompt.png" alt="" /><figcaption><b>図 1.</b> [Content Details] 画面に、定期購読するか 1 日限りのパスを購入するかを選択するボタンが表示されます。</figcaption></figure>

<p>ユーザーが [Go Premium] ボタンか [Daily Pass] ボタンをクリックすると、Fire TVアカウントを使用して購入するための画面が表示されます。たとえば、ユーザーが [Go Premium] をクリックすると、次の画面が表示されます。</p>

<figure><img class="docimage " src="docs_ja/firetv/fireappbuilder/images/fireappbuilder_iapsubscriptionoptions.png" alt="" /><figcaption><b>図 2.</b> 定期購読オプションのダイアログボックスが表示されます。</figcaption></figure>

<p>[Daily Pass] をクリックした場合は、次の画面が表示されます。</p>

<figure><img class="docimage " src="docs_ja/firetv/fireappbuilder/images/fireappbuilder_iaprentaloptions.png" alt="" /><figcaption><b>図 3.</b> レンタルオプションのダイアログボックスが表示されます。</figcaption></figure>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> 開発者はアプリ内課金アイテムを設定する際に、これらのダイアログボックスに表示されるテキストをカスタマイズできます。</div>

<p>ユーザーはFire TVダイアログボックスで、Fire TVのセットアップ時に入力したAmazonアカウントを使用してトランザクションを完了します。トランザクションが完了すると、次の画面が表示されます。</p>

<figure><img class="docimage " src="docs_ja/firetv/fireappbuilder/images/fireappbuilder_iappromptcomplete.png" alt="" /><figcaption><b>図 4.</b> 注文が完了しました。</figcaption></figure>

<p>この後、ユーザーはコンテンツの視聴を開始できます。</p>

<h2 id="アプリ内課金に関する注意事項と制限事項">アプリ内課金に関する注意事項と制限事項</h2>

<p>アプリ内課金コンポーネントを使用する際は、下記の点に注意してください。</p>

<ul>
  <li>メディアには、Daily Pass (24 時間のアクセス) とGo Premium (定期購読) の両方のオプションを提供する必要があります。</li>
  <li>Daily PassまたはGo Premiumを購入したユーザーは、アプリ内の<em>すべて</em>のメディアにアクセスできます。アイテムを個別に指定して定期購読やレンタルから除外し、残りを無制限で提供するということはできません。</li>
  <li>映画を視聴している途中でDaily Passや定期購読の期限が切れた場合、ユーザーはその映画を最後まで視聴できます。アプリ内課金コンポーネントによって映画が停止されることはありません。</li>
  <li>1 つのメディアに対して複数の定期購読タイプを提供することはできません。たとえば、コンテンツの再生にSDとHDのオプションを提供したり、月間購読と年間購読を提供したりすることはできません。</li>
  <li>Daily Passは購入操作を行った端末でのみ使用できます。別のFire TV端末にログインしても、購入済みのDaily Passは機能しません。</li>
  <li>Go Premium定期購読はすべての端末で機能します (あるFire TV端末で購入した定期購読を別のFire TV端末で利用できます)。ただし、別の端末にログインしたユーザーは、アプリを再起動して定期購読を有効にする必要があります。</li>
  <li>Daily Passを購入したユーザーのFire TVアプリに障害が発生し、データが失われた場合、ユーザーはそのアプリからDaily Passにアクセスできなくなります。ただし、Go Premium (定期購読) では、障害が発生した後にアプリを再起動すれば引き続きアクセスできます。</li>
  <li>ユーザーがコンテンツを定期購読した後で [Back] ボタンをクリックすると、[Go Premium] ボタンが再び表示されます。ただし、ユーザーがもう一度定期購読しようとすると、アプリによってユーザーがすでに定期購読をしていることが認識され、メディアへのアクセスが提供されます。</li>
</ul>

<h2 id="amazonアプリ内課金コンポーネントのワークフロー">Amazonアプリ内課金コンポーネントのワークフロー</h2>

<p>以下の手順は、Amazonアプリ内課金コンポーネントの支払いワークフローを示しています。</p>

<ol>
  <li>アプリを起動すると、アプリ内課金APIを通じて、現在ログインしているユーザーの既存の購入情報が取得され、最新のレシートに基づいて購入商品が更新されます。</li>
  <li>ユーザーが [Content Details] 画面で [Daily Pass] ボタンか [Go Premium] ボタンをクリックします (ユーザーはまだメディアを購入していない前提です)。</li>
  <li>アプリによってアプリ内課金APIが呼び出され、対象アイテムに関するユーザートランザクションが処理されます。ユーザーは自分がセットアップしたFire TVアカウントオプションを使用して購入を完了します。</li>
  <li>トランザクションが正常に完了すると、アプリ内課金APIによってトランザクションからアプリにレシートIDが返されます。</li>
  <li>(省略可能) レシートが有効であることを確認するために、自分のサービスに変更を加え、Receipt Verification Serviceにリクエストを送信してレシートIDが有効かどうかを確認するよう設定できます。6.  レシートIDが有効であれば、アプリによってメディアが表示されます。</li>
</ol>

<h2 id="構成の概要">構成の概要</h2>

<p>アプリ内課金コンポーネントをセットアップするには、開発者ポータルの [In-App Items] セクションでDaily Passアイテム (消耗品) とGo Premiumアイテム (定期購読) を作成します。これらのアイテムのSKU情報を使用してアプリを構成します。必要な情報はコンポーネントによってアプリ内課金APIに送信されます。</p>

<p>Amazonアプリ内課金コンポーネントでは、IAP APIのラッパーが使用されます。利用できる機能は本来のIAPの一部のみです。そのため、本ドキュメントでは、<a href="https://developer.amazon.com/public/ja/apis/earn/in-app-purchasing">IAPに関するドキュメント</a>の一部に変更を加えて記載しています。</p>

<h3 id="daily-pass-消耗品-とgo-premium-定期購読">Daily Pass (消耗品) とGo Premium (定期購読)</h3>

<p>アプリ内課金では、消耗品、権限、定期購読の 3 種類のアイテムが提供されています。Fire App Builderのアプリ内課金コンポーネントに関連するのは、消耗品と定期購読のみです (このコンポーネントは、IAP APIをベースにしたラッパーであるため、IAP API機能のすべてが適用されるわけではありません)。消耗品アイテムと定期購読アイテム (権限アイテム以外) はどちらもAmazonアプリ内課金コンポーネントにマップされています。</p>

<p>消耗品と定期購読の相違点は以下のとおりです。</p>

<ul>
  <li><strong>消耗品</strong> (<strong>Daily Pass</strong>に相当) はアプリ内で消費され、何回でも購入できます。消耗品アイテムは、Fire App Builder内で “Daily Pass” にマップされています。ユーザーがすべてのメディアに 24 時間アクセスできようにする場合は、この種類を選択します。</li>
  <li><strong>定期購読</strong> (<strong>Go Premium</strong>に相当) では、購読期間中にコンテンツや機能のプレミアムセットにアクセスできます。定期購読アイテムは、Fire App Builder内で “Go Premium” にマップされています。ユーザーが購読期間中すべてのメディアにアクセスできようにする場合は、この種類を選択します。</li>
</ul>

<h3 id="amazonアプリ内課金コンポーネントの構成">Amazonアプリ内課金コンポーネントの構成</h3>

<p>アプリ内課金コンポーネントを構成するには、次の手順に従います。</p>

<ul>
  <li><a href="#createapp">手順 1. 開発者ポータルでアプリを作成する</a></li>
  <li><a href="#creategopassitem">手順 2. 消耗品 (Daily Pass) アプリ内アイテムを作成する</a></li>
  <li><a href="#creategopremiumitem">手順 3. 定期購読 (Go Premium) アプリ内アイテムを作成する</a></li>
  <li><a href="#downloadjson">手順 4. JSONデータファイルをダウンロードしてプッシュする</a></li>
  <li><a href="#enableiap">手順 5. アプリでアプリ内課金コンポーネントを有効にする</a></li>
  <li><a href="#mapinappitems">手順 6. アプリでアプリ内アイテムをコンテンツにマップする</a></li>
  <li><a href="#buttontext">手順 7. ボタンテキストをカスタマイズする</a></li>
  <li><a href="#apptester">手順 8. App Testerを設定する</a></li>
</ul>

<h2 id="createapp">手順 1. 開発者ポータルでアプリを作成する</h2>

<p>すでにアプリを作成済みの場合は、このセクションをスキップして<a href="#creategopassitem">次へ</a>進んでください。</p>

<ol>
  <li>開発者ポータルにログインします。</li>
  <li>[<strong>新しいアプリを追加する</strong>] をクリックし、[Choose a Platform] ダイアログボックスで [<strong>Android</strong>] を選択します。[<strong>Next</strong>] をクリックします。</li>
  <li>
    <p>基本的なフィールドにアプリの情報を入力します。</p>

    <ul>
      <li><strong>アプリのタイトル</strong>: アプリの名前。</li>
      <li><strong>アプリSKU</strong>: アプリの一意の識別子 (例: <code class="highlighter-rouge">mycalypsomediapp1234</code>)。SKUの最大文字数は 150 文字です。使用できる文字は、a～z、A～Z、0～9、アンダースコア、ピリオド、およびダッシュです。SKUでは大文字と小文字が区別されます。
     *  <strong>カテゴリ</strong>: アプリとメディアに適したカテゴリを選択します。</li>
    </ul>
  </li>
  <li>[<strong>カスタマーサポートの連絡先</strong>] では、[<strong>デフォルトのサポート情報を使用する</strong>] を選択するか、フィールドをカスタマイズします。[<strong>保存</strong>] をクリックします。</li>
</ol>

<h2 id="creategopassitem">手順 2. 消耗品 (Daily Pass) アプリ内アイテムを作成する</h2>

<ol>
  <li>開発者ポータルにログインし、[<strong>ダッシュボード</strong>] に移動して、当該アプリをクリックします。</li>
  <li>アプリの [<strong>アプリ内アイテム</strong>] タブをクリックします。</li>
  <li>
    <p>[<strong>Add a Consumable</strong>] ボタン (Daily Pass用) をクリックします。</p>

    <figure><img class="docimage " src="docs_ja/firetv/fireappbuilder/images/fireappbuilder_iaprentaloptions.png" alt="" /><figcaption><b>図 5.</b> レンタルオプションのダイアログボックスが表示されます。</figcaption></figure>
  </li>
  <li>
    <p>次の表に定義されているフィールドに値を入力します。</p>

    <table>
  <thead>
    <tr>
      <th>フィールド</th>
      <th>説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Title</strong></td>
      <td>このアイテムを参照するための名前。このタイトルはユーザーには表示されません。わかりやすいように、「<strong>Daily Pass</strong>」と入力します。</td>
    </tr>
    <tr>
      <td><strong>SKU</strong></td>
      <td>このアイテムのIDとなる、アプリに固有の文字列。例: "com.amazon.example.iap.mydailypassitem"。アプリが使用するSKUは、Amazonアプリストアに申請するSKUと同じである必要があります。前述の (アプリを作成した際と同じ) SKU文字に関する要件が、ここでも適用されます。</td>
    </tr>
    <tr>
      <td><strong>コンテンツデリバリー</strong></td>
      <td>配信するコンテンツはアプリの一部として含まれるため、[<strong>No additional file required</strong>] を選択します。</td>
    </tr>
  </tbody>
</table>
  </li>
  <li>
    <p>[<strong>保存</strong>] をクリックします。</p>

    <div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> 次のタブに移動する前に、必ず、現在のタブに入力した情報を保存してください。</div>
  </li>
  <li>
    <p>[<strong>配信地域・価格等</strong>] タブをクリックし、次の表に示す詳細情報を入力します。</p>

    <table>
  <thead>
    <tr>
      <th>フィールド</th>
      <th>説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Are you charging for this consumable / entitlement?</strong></td>
      <td>[<strong>はい。基本表示価格は...</strong>] を選択します。フィールドが表示され、そこにアイテムの基本表示価格と通貨を設定できます。基本表示価格を設定した後で、他の通貨向けの価格を手動で設定するか、Amazonアプリストアが交換レートと税金に基づいて設定するのを許可することができます。有効な価格 (USDの場合) は、0.00 USDか、0.99～99.00 USDです。</td>
    </tr>
    <tr>
      <td><strong>When would you like this item to be available?</strong></td>
      <td>アプリでこのアイテムの提供を開始する日付を指定します (IAPでは米国太平洋標準時が使用されます)。このフィールドを空白のままにすると、アイテムはAmazonアプリストアの承認後すぐに提供が開始されます。</td>
    </tr>
  </tbody>
</table>
  </li>
  <li>[<strong>保存</strong>] をクリックします。</li>
  <li>[<strong>説明</strong>] タブをクリックします。</li>
  <li>
    <p>[<strong>表示タイトル</strong>] フィールドと [<strong>説明</strong>] フィールドに入力します。</p>

    <p>これらのフィールドは、ユーザーが [<strong>Daily Pass</strong>] をクリックするとダイアログボックスに表示されます。</p>

    <figure><img class="docimage " src="docs_ja/firetv/fireappbuilder/images/fireappbuilder_iaprentaloptions.png" alt="" /><figcaption><b>図 6.</b> [表示タイトル] フィールドと [説明] フィールドが表示されます。</figcaption></figure>
  </li>
  <li>[<strong>保存</strong>] をクリックします。</li>
  <li>[<strong>画像</strong>] タブをクリックします。</li>
  <li>サイズの要件に従って、2 つの画像をアップロードします。アプリでユーザーに表示されるDaily Passダイアログボックスには、114pxの画像のみが表示されます。前出のスクリーンショット (図 6) では、画像がオレンジ色の四角形になっています。512pxの画像を作成する際は、便宜的に、こちらの<a href="https://images-na.ssl-images-amazon.com/images/G/01/mobile-apps/dex/firetv/512.png">汎用画像</a>をアップロードできます。</li>
  <li>
    <p>[<strong>保存</strong>] をクリックします。</p>

    <div class="alert alert-danger" role="alert"><i class="fa fa-exclamation-circle"></i> <b>Warning:</b> まだ [<strong>Submit In-App Item</strong>] ボタンをクリックしないでください。アプリ内アイテムはいったん申請すると、後で編集または削除することができません。このボタンは、機能とコンテンツを十分にテストし、アプリを申請する準備ができた後でのみクリックしてください。</div>
  </li>
</ol>

<h2 id="creategopremiumitem">手順 3. 定期購読 (Go Premium) アプリ内アイテムを作成する</h2>

<ol>
  <li>ログインしていない場合は開発者ポータルにログインし、[<strong>ダッシュボード</strong>] に移動して、対象のアプリをクリックします。</li>
  <li>アプリの [<strong>アプリ内アイテム</strong>] タブをクリックします。</li>
  <li>
    <p>[<strong>Add a Subscription</strong>] ボタン (Go Premium用) をクリックします(“Subscriptions are not supported by Amazon Underground” というメッセージが表示された場合は、[<strong>Add a Subscription</strong>] ボタンをもう一度クリックしてください)。5.  次の表に定義されているフィールドに値を入力します。</p>

    <table>
  <thead>
    <tr>
      <th>フィールド</th>
      <th>説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Title</strong></td>
      <td>このアイテムを参照するための名前。このタイトルはユーザーには表示されません。わかりやすいように、「<strong>Go Premium</strong>」と入力します。</td>
    </tr>
    <tr>
      <td><strong>SKU</strong></td>
      <td>このアイテムのIDとなる、アプリに固有の文字列。例: "com.amazon.example.iap.mygopremiumitem"。アプリが使用するSKUは、Amazonアプリストアに申請するSKUと同じである必要があります。前述の (アプリを作成した際と同じ) SKU文字に関する要件が、ここでも適用されます。</td>
    </tr>
    <tr>
      <td><strong>コンテンツデリバリー</strong></td>
      <td>配信するコンテンツはアプリの一部として含まれるため、[<strong>No additional file required</strong>] を選択します。</td>
    </tr>
  </tbody>
</table>
  </li>
  <li>
    <p>[<strong>保存</strong>] をクリックします。</p>

    <div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> 次のタブに移動する前に、必ず、現在のタブに入力した情報を保存してください。</div>
  </li>
  <li>
    <p>[<strong>購読期間</strong>] タブをクリックし、次の表に示すフィールドに値を入力します。</p>

    <table>
  <thead>
    <tr>
      <th>フィールド</th>
      <th>説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>購読期間</strong></td>
      <td>適用する購読期間を選択します。購読期間は購入日から始まります。</td>
    </tr>
    <tr>
      <td><strong>SKU</strong></td>
      <td>この購読期間に対応する一意のSKUを入力します (他のSKUフィールドと同じガイドラインに準拠してください)。例: "com.amazon.example.calypso.monthly"。このSKUは、アイテムの詳細ページで入力したSKUの子SKUです。</td>
    </tr>
    <tr>
      <td><strong>無料体験</strong></td>
      <td>必要に応じて、定期購読の無料体験期間を指定します。</td>
    </tr>
    <tr>
      <td><strong>定期購読の料金を請求しますか?</strong></td>
      <td>[<strong>はい。基本表示価格は...</strong>] を選択します。フィールドが表示され、そこに基本表示価格と通貨を設定できます。基本表示価格を設定した後で、他の通貨向けの価格を手動で設定するか、Amazonアプリストアが交換レートと税金に基づいて設定するのを許可することができます。有効な価格 (USDの場合) は、0.00 USDか、0.99～99.00 USDです。</td>
    </tr>
    <tr>
      <td><strong>When would you like this item to be available?</strong></td>
      <td>アプリでこのアイテムの提供を開始する日付を指定します (IAPでは米国太平洋標準時が使用されます)。このフィールドを空白のままにすると、アイテムはAmazonアプリストアの承認後すぐに提供が開始されます。</td>
    </tr>
  </tbody>
</table>

    <div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> [保存して購読期間を追加] ボタンは無視してください。課金コンポーネントは 1 つの購読期間のみをサポートしています。</div>
  </li>
  <li>[<strong>保存</strong>] をクリックします。</li>
  <li>[<strong>説明</strong>] タブをクリックします。</li>
  <li>
    <p>[<strong>表示タイトル</strong>] フィールドと [<strong>説明</strong>] フィールドに入力します。</p>

    <p>これらのフィールドは、ユーザーが [<strong>Go Premium</strong>] をクリックするとダイアログボックスに表示されます。</p>

    <figure><img class="docimage " src="docs_ja/firetv/fireappbuilder/images/fireappbuilder_iaprentaloptions.png" alt="" /><figcaption><b>図 7.</b> [表示タイトル] フィールドと [説明] フィールドが表示されます。</figcaption></figure>
  </li>
  <li>[<strong>保存</strong>] をクリックします。</li>
  <li>[<strong>画像</strong>] タブをクリックします。</li>
  <li>開発者コンソールで画像のアイコンが要求されますが、Daily Pass (消耗品) とは異なり、アプリでユーザーに表示される [Go Premium] ダイアログボックスではどの画像も<em>使用されません</em>。便宜的に、こちらの汎用 <a href="https://images-na.ssl-images-amazon.com/images/G/01/mobile-apps/dex/firetv/114.png">114px画像</a>やこちらの汎用 <a href="https://images-na.ssl-images-amazon.com/images/G/01/mobile-apps/dex/firetv/512.png">512px画像</a>をアップロードできます。</li>
  <li>
    <p>[<strong>保存</strong>] をクリックします。</p>

    <div class="alert alert-danger" role="alert"><i class="fa fa-exclamation-circle"></i> <b>Warning:</b> まだ [<strong>Submit In-App Item</strong>] ボタンをクリックしないでください。アプリ内アイテムはいったん申請すると、後で編集または削除することができません。このボタンは、機能とコンテンツを十分にテストし、アプリを申請する準備ができた後でのみクリックしてください。</div>
  </li>
</ol>

<h2 id="downloadjson">手順 4.JSONデータファイルをダウンロードしてプッシュする</h2>

<p>Daily PassとGo Premiumの両方のアプリ内アイテムを設定したら、アプリ内アイテムの詳細が含まれたJSONファイルをダウンロードします。</p>

<ol>
  <li>ログインしていない場合は開発者ポータルにログインし、[<strong>ダッシュボード</strong>] に移動して、対象のアプリをクリックします。</li>
  <li>
    <p>アプリの [<strong>アプリ内アイテム</strong>] タブをクリックします。4. [<strong>JSON Data File</strong>] ボタンをクリックし、アプリ内アイテムの詳細が含まれたJSONファイルをダウンロードします。</p>

    <figure><img class="docimage " src="docs_ja/firetv/fireappbuilder/images/fireappbuilder_jsonfiledownload.png" alt="" /></figure>
  </li>
  <li>ターミナルで<code class="highlighter-rouge">cd</code>を実行し、このファイルが含まれているディレクトリに移動します。</li>
  <li>
    <p>次のコマンドを使用して、JSONファイルをFire TV端末にプッシュします。</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>adb push amazon.sdktester.json /mnt/sdcard/
</code></pre>
    </div>

    <p>レスポンスが次のように表示されます。<code class="highlighter-rouge">[100%] /mnt/sdcard/amazon.sdktester.json</code></p>
  </li>
</ol>

<h2 id="enableiap">手順 5. アプリでアプリ内課金コンポーネントを有効にする</h2>

<p>開発者コンソールでアプリ内アイテムを作成できたら、続いてはアプリでIAPコンポーネントを有効にする必要があります。</p>

<ol>
  <li>Amazonアプリ内課金コンポーネントをアプリにロードします。アプリにコンポーネントをロードする方法の詳細については、「<a href="fire-app-builder-load-a-component.html">コンポーネントをロードする</a>」を参照してください。</li>
  <li>Android Studio (Androidビュー) で、<strong>ContentBrowser</strong>フォルダーを展開し、<strong>res &gt; values</strong>に移動して、custom.xmlファイルを開きます。</li>
  <li>
    <p>次の文字列をコピーします。</p>

    <div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;bool</span> <span class="na">name=</span><span class="s">"is_iap_disabled"</span><span class="nt">&gt;</span>true<span class="nt">&lt;/bool&gt;</span>
</code></pre>
    </div>

    <p>(<code class="highlighter-rouge">override_all_contents_subscription_flag</code>フィールドは無視してください。)</p>
  </li>
  <li><strong>app</strong>フォルダーで (<strong>res &gt; values</strong>にあります).<strong>custom.xml</strong>ファイルを開きます</li>
  <li>
    <p>先ほどコピーした文字列を貼り付け、値を<code class="highlighter-rouge">false</code>に変更します。この文字列は必ず 2 つの<code class="highlighter-rouge">resources</code>タグの間に配置してください。</p>

    <div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;bool</span> <span class="na">name=</span><span class="s">"is_iap_disabled"</span><span class="nt">&gt;</span>false<span class="nt">&lt;/bool&gt;</span>
</code></pre>
    </div>

    <div class="alert alert-success" role="alert"><i class="fa fa-check-square-o"></i> <b>Tip:</b> これは二重否定となっているため、<code class="highlighter-rouge">false</code>に設定することで実際にはアプリでIAPが有効化されます。</div>

    <p>コンポーネントにすでに設定されている値は、アプリのcustom.xmlの値によって上書きされます。</p>
  </li>
</ol>

<h2 id="mapinappitems">手順 6. アプリでアプリ内アイテムをコンテンツにマップする</h2>

<ol>
  <li>
    <p>Android Studio (Androidビュー) で<strong>PurchaseInterface</strong>フォルダーを展開し、<strong>assets</strong>に移動します。<strong>skuslist.json</strong>ファイルを開きます。</p>
  </li>
  <li>
    <p>“Go Premium”アイテムの場合は、赤で示されているフィールドを実際のGo PremiumアイテムのSKU値に置き換えます。</p>

    <pre>
{
  "skusList": [
    {
      "sku": "<span class="red">testSubSku</span>",
      "productType": "SUBSCRIBE",
      "purchaseSku": "<span class="red">testSubSku</span>"
    },
    {
      "sku": "RentUnPurchased",
      "productType": "RENT",
      "purchaseSku": "RentUnPurchased"
    }
  ],
  "actions": {
    "CONTENT_ACTION_DAILY_PASS": "RentUnPurchased",
    "CONTENT_ACTION_SUBSCRIPTION": "<span class="red">testSubSku</span>"
  }
}
</pre>

    <p>Go Premiumアイテムは定期購読 (SUBSCRIBE) アイテムです。</p>
  </li>
  <li>
    <p>“Daily Pass” アイテムの場合は、赤で示されているフィールドを実際のDaily PassアイテムのSKU値に置き換えます。</p>

    <pre>
{
  "skusList": [
    {
      "sku": "testSubSku",
      "productType": "SUBSCRIBE",
      "purchaseSku": "testSubSku"
    },
    {
      "sku": "<span class="red">RentUnPurchased</span>",
      "productType": "RENT",
      "purchaseSku": "<span class="red">RentUnPurchased</span>"
    }
  ],
  "actions": {
    "CONTENT_ACTION_DAILY_PASS": "<span class="red">RentUnPurchased</span>",
    "CONTENT_ACTION_SUBSCRIPTION": "testSubSku"
  }
}
</pre>

    <p>Daily Passアイテムはレンタル (RENT) アイテムです。</p>
  </li>
</ol>

<h2 id="buttontext">手順 7.ボタンテキストをカスタマイズする</h2>

<p>[Content Details] 画面のボタンに表示される “Daily Pass” または “Go Premium” というテキストをカスタマイズできます。</p>

<p>テキストをカスタマイズするには:</p>

<ol>
  <li><strong>ContentBrowser &gt; res &gt; values</strong>に移動し、<strong>strings.xml</strong>ファイルを開きます。</li>
  <li>
    <p>次の文字列をコピーし、アプリの<strong>custom.xml</strong>ファイルに貼り付けます。</p>

    <div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"premium_1"</span><span class="nt">&gt;</span>Go<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"premium_2"</span><span class="nt">&gt;</span>Premium<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"daily_pass_1"</span><span class="nt">&gt;</span>Daily<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"daily_pass_2"</span><span class="nt">&gt;</span>Pass<span class="nt">&lt;/string&gt;</span>
</code></pre>
    </div>

    <p>また、課金コンポーネントに関連のある他の文字列もコピーします。</p>

    <div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"iap_error_dialog_title"</span><span class="nt">&gt;</span>Purchase Error<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"subscription_expired"</span><span class="nt">&gt;</span>Your subscription expired!<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"ok"</span><span class="nt">&gt;</span>Ok<span class="nt">&lt;/string&gt;</span>
</code></pre>
    </div>
  </li>
  <li>必要に応じて、文字列の値をカスタマイズします。</li>
</ol>

<h2 id="apptester">手順 8.App Testerを設定する</h2>

<p>アプリ内アイテムをセットアップし、アプリを構成できたら、統合状態をテストし、IAPとメディアが正しく連携するかを確認します。</p>

<p>アプリストアにアプリを申請する前に、実際の購入を行わずにアプリのアプリ内アイテムをテストするには、IAP App Testerを使用します。App Testerは、サンドボックスサーバーを使用してアプリ内課金APIの呼び出しをシミュレートします。App Testerはアプリ内課金APIへの発信呼び出しをインターセプトし、有効なレシートを返して、トランザクションを許可します(詳細については、「<a href="https://developer.amazon.com/public/ja/apis/earn/in-app-purchasing/docs-v2/installing-and-configuring-app-tester">App Testerをインストールして設定する</a>」を参照してください)。</p>

<p>App Testerを設定するには:</p>

<ol>
  <li>
    <p>コンピューターのブラウザで<a href="https://www.amazon.com/gp/product/?ie=UTF8&amp;ASIN=B00BN3YZM2&amp;ref=mas_ty">アプリストアのApp Tester</a>にアクセスし、このアプリを入手して (無料)、端末に配信します。</p>

    <p>アプリを端末に配信するには、Fire TVをセットアップしたときに使用したものと同じ認証情報を使用してAmazonにサインインする必要があります。[Deliver to] オプションを使用して、アプリを端末に配信します。</p>

    <figure><img class="docimage " src="docs_ja/firetv/fireappbuilder/images/fireappbuilder_apptesterdelivery.png" alt="" /><figcaption><b>図 9.</b> [Deliver to] オプションを使用して、Fire TV端末にアプリを送信できます。</figcaption></figure>
  </li>
  <li>Fire TVで [<strong>Settings</strong>] &gt; [<strong>My Account</strong>] &gt; [<strong>Sync Amazon Content</strong>] の順に選択して、購入情報を端末と同期します。</li>
  <li>Fire TVホーム画面から [<strong>アプリ</strong>] に移動し、[<strong>Your Apps Library</strong>] を選択します。</li>
  <li>[<strong>Amazon App Tester</strong>] アプリを選択してダウンロードし、クラウドからアプリをインストールします。</li>
  <li>ダウンロードが完了したら、アプリを起動します。</li>
  <li>
    <p>[<strong>アプリ内課金API</strong>] セクションをクリックします。</p>

    <figure><img class="docimage " src="docs_ja/firetv/fireappbuilder/images/fireappbuilder_iaptester.png" alt="" /><figcaption><b>図 10.</b> アプリ内課金APIオプション。</figcaption></figure>
  </li>
  <li>[<strong>5. IAP Items in JSON File</strong>] を選択し、amazon.sdktester.jsonファイルに含まれるアイテムがここに表示されていることを確認します。</li>
</ol>

<h3 id="呼び出しをシミュレートする">呼び出しをシミュレートする</h3>

<p>アプリとテストツールを構成できたので、IAPサービスの呼び出しをシミュレートできます。</p>

<ol>
  <li><a href="fire-app-builder-connecting-adb-to-fire-tv.html">ADB</a>を使用して、アプリを起動します</li>
  <li>アプリのメディアを参照します。</li>
  <li>[<strong>Daily Pass</strong>] ボタンまたは [<strong>Subscribe</strong>] ボタンをクリックします。</li>
</ol>

<h3 id="アプリ内アイテムを調整する">アプリ内アイテムを調整する</h3>

<p>[説明] タブの [タイトル] フィールドと [説明] フィールドを、アプリに表示されるテキストに合わせて調整できます。</p>

<p>アプリ内アイテムのテキストやその他の機能を調整するには、管理コンソールにログインして、対象のアプリをクリックし、[In-App Items] タブを開きます。アプリを申請する前であれば、すべてのフィールドを編集できます。</p>

<h3 id="購入情報をリセットする">購入情報をリセットする</h3>

<p>機能のテスト時に、次の手順に従ってDaily PassやGo Premiumの購入情報をリセットできます。</p>

<ol>
  <li>[<strong>設定</strong>] &gt; [<strong>アプリ</strong>] &gt; [<strong>インストールしたアプリの管理</strong>] &gt; [<strong>Amazon App Tester</strong>] に移動します。</li>
  <li>[<strong>Clear data</strong>] および [<strong>Clear cache</strong>] を選択します。</li>
</ol>

<h2 id="additionalsecurity">Receipt Verification Serviceを使用したセキュリティの強化</h2>

<p>ユーザーがメディアのDaily Passまたは定期購読を購入すると、トランザクションが有効かどうかを示すレシートがIAP APIによってアプリに返されます。Fire TV端末はユーザーが所有しているため、IAP APIへの発信呼び出しをハッカーが再ルーティングしてレシートを偽造する可能性があります。</p>

<p>IAP APIから返されたレシートが有効であることを確認するために、<em>開発するサービス</em>がAmazonの<a href="https://developer.amazon.com/public/apis/earn/in-app-purchasing/docs-v2/verifying-receipts-in-iap-2.0">Receipt Verification Service</a>を呼び出すように設定できます。</p>

<p>以下は、Fire App Builderを使用してReceipt Verification Serviceでレシートを確認するための一般的なプロセスです。</p>

<ul>
  <li>お使いのサーバーを (任意の言語/プラットフォームを使用して) レシートおよび付随するシークレットをReceipt Verification Serviceに送信してレシートが有効かどうかを問い合わせるように設定します。</li>
  <li>アプリによって、必要なプロパティと共有シークレットが含まれたリクエストがReceipt Verification Serviceに送信され、レシートが確認されます。必要な値は<strong>AmazonInAppPurchaseComponent &gt; res &gt; values values.xml</strong>に記載されています。</li>
  <li>Receipt Verification Serviceでは、シークレットを検証した後、レシートが有効であるかどうかを判断し、レスポンスでtrueまたはfalseを返します。</li>
</ul>

<p>このワークフローはFire App Builderには含まれていません。Fire App Builderはデフォルトで、常に有効を返すダミーサービスを呼び出します。具体的には、Fire App Builderの (AmazonInAppPurchaseComponentフォルダー内にある) <code class="highlighter-rouge">AReceiptVerifier</code>クラスは抽象クラスで、開発者はそのサブクラスを拡張してReceipt Verification Serviceを呼び出します。</p>

<p>Fire App Builderに用意された<code class="highlighter-rouge">DefaultReceiptVerificationService</code>は、<code class="highlighter-rouge">AReceiptVerifier</code>を拡張したサンプルサブクラスです。<code class="highlighter-rouge">DefaultReceiptVerificationService</code>内の<code class="highlighter-rouge">validateReceipt</code>メソッドによって、Receipt Verification Serviceに必要なパラメータがすべて実装されます。</p>

<ul>
  <li><code class="highlighter-rouge">context</code>:   アプリのコンテキスト</li>
  <li><code class="highlighter-rouge">requestId</code>: このリクエストのリクエストID</li>
  <li><code class="highlighter-rouge">sku</code>:       レシートのSKU</li>
  <li><code class="highlighter-rouge">userData</code>:  現在のユーザーのユーザーデータ</li>
  <li><code class="highlighter-rouge">receipt</code>:   検証するレシート</li>
  <li><code class="highlighter-rouge">listener</code>:  このリクエストのリスナー</li>
  <li><code class="highlighter-rouge">return</code>: リクエストID</li>
</ul>

<p>ただし、実際には<code class="highlighter-rouge">validateReceipt</code>によってReceipt Verification Serviceは呼び出されません。代わりに、成功のステータスが返されます。</p>

<p>開発者は自分でサブクラスを作成し、実際のReceipt Verification Service呼び出しで<code class="highlighter-rouge">AReceiptVerifier</code>を拡張する必要があります(または、<code class="highlighter-rouge">DefaultReceiptVerificationService</code>サブクラスをカスタマイズすることもできます)。</p>

<p>サブクラスを作成する際は、次の手順に従ってアプリのcustom.xmlファイルにサブクラス名を指定する必要があります。</p>

<ol>
  <li><strong>AmazonInAppPurchaseComponent &gt; res &gt; values</strong>に移動し、<strong>strings.xml</strong>ファイルを開きます。</li>
  <li>
    <p>次の<code class="highlighter-rouge">receipt_verification_service_iap</code>文字列をコピーし、アプリの<strong>custom.xml</strong>ファイル (app &gt; resourcesの内側) に貼り付けます。</p>

    <div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"receipt_verification_service_iap"</span><span class="nt">&gt;</span>com.amazon.inapppurchase.DefaultReceiptVerificationService<span class="nt">&lt;/string&gt;</span>
</code></pre>
    </div>
  </li>
  <li>アプリの<strong>custom.xml</strong>ファイルで、文字列の値をサブクラスへの完全なパスに置き換えます。デフォルトでは、<code class="highlighter-rouge">DefaultReceiptVerificationService</code>が構成されています。新しいサブクラスを作成するか、<code class="highlighter-rouge">DefaultReceiptVerificationService</code>クラスを上書きできます。</li>
</ol>

<p>Receipt Verification Serviceの呼び出しの詳細については、「<a href="https://developer.amazon.com/public/apis/earn/in-app-purchasing/docs-v2/verifying-receipts-in-iap-2.0">Receipt Verification Service</a>」を参照してください。</p>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> 実装するセキュリティレベルは、正当なトランザクションの確認に費やすリソースによって異なります。お使いのサーバーでレシートを確認することが適切である (サーバー管理コストが収益を上回らない) 場合に、Receipt Verification Serviceを使用したこのセキュリティ強化を実装してください。アプリの収益がサーバー管理のコストや手間に見合わない場合は、この追加の設定を省略できます。</div>

<h2 id="アプリ内アイテムを本番環境に申請する">アプリ内アイテムを本番環境に申請する</h2>

<p>ここまでは、テスト環境でアプリを構成する方法について説明してきました。アプリストアにアプリを申請する準備が整ったら、アプリ内アイテムも申請する必要があります。</p>

<p>アプリ内アイテムを申請するには:</p>

<ol>
  <li>開発者ポータルにログインし、[<strong>ダッシュボード</strong>] に移動して、当該アプリをクリックします。</li>
  <li>アプリの [<strong>アプリ内アイテム</strong>] タブをクリックします。3.  [<strong>Submit In-App Item</strong>] ボタンをクリックします。</li>
</ol>

<p>アプリ内アイテムはいったん申請すると、後で編集することができません。すでに申請したアプリ内アイテムを変更する必要が生じた場合は、<a href="https://developer.amazon.com/public/support/submitting-your-app/tech-docs/submitting-your-app#Updating an Existing App">アプリの新しいバージョンを作成する</a>か、新しいアプリを作成して、そのアプリに新しいアプリ内アイテムを追加する必要があります。</p>

<!-- common links -->


                    <div class="toc-main-column">
                        

                    </div>

            </div>
        </div><!--/.container-->


    </div><!--/.page-container-->
    
    <div class="footertop">
    <div class="container">
        <div class="col-md-6">
            <p></p>
        </div>
        <div class="col-md-6">
            <ul class="bottom_ul">
                <!--<li><a href="http://developer.amazon.com" class="noCrossRef productSubtitle"> Home</a> </li><li> <a href="index.html" class="noCrossRef productSubtitle"> Documentation</a></li><li>Fire App Builder</li>-->
        </div>
    </div>
</div>

<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-4 col-sm-6 footerleft ">
                <div class="logofooter"> About the Developer Portal</div>
                <p>The Amazon Developer Portal provides documentation for developers creating apps for the Amazon
                    appstore, including Alexa skills. Apps include streaming media apps, game apps, and more. </p>
                <p><i class="fa fa-map-pin"></i> 1120 Enterprise Way, Sunnyvale, California</p>
                <p><i class="fa fa-envelope"></i> E-mail : someemail@amazon.com</p>

            </div>
            <div class="col-md-2 col-sm-6 paddingtop-bottom">
                <h6 class="heading7">Links</h6>
                <ul class="footer-ul">
                    <li><a href="#"> Doc index</a></li>
                    <li><a href="#"> Blog</a></li>
                    <li><a href="#"> Developer.amazon.com</a></li>
                    <li><a href="#"> AWS docs</a></li>
                    <li><a href="#"> Amazon Appstore</a></li>
                </ul>
            </div>

            <div class="col-md-3 col-sm-6 paddingtop-bottom">
                <h6 class="heading7">Amazon News</h6>
                <ul class="footer-ul">
                    <li><a href="#">Developer.amazon.com blog</a></li>
                    <li><a href="#">AWS blog</a></li>
                    <li><a href="#">Amazon newsroom</a></li>
                    <li><a href="#">Other Amazon blogs</a></li>
                </ul>
            </div>

            <div class="col-md-3 col-sm-6 paddingtop-bottom">
                <h6 class="heading7">Forums</h6>
                <ul class="footer-ul">
                    <li><a href="#">Amazon Underground</a></li>
                    <li><a href="#">General Android</a></li>
                    <li><a href="#">Amazon Dash Replenishment</a></li>
                    <li><a href="#">Merch by Amazon</a></li>
                    <li><a href="#">Alexa</a></li>
                    <li><a href="#">Amazon Fire Devices</a></li>
                    <li><a href="#">Appstore</a></li>
                    <li><a href="#">Mobile APIs and Services</a></li>
                </ul>
            </div>
        </div>
    </div>
    </div>
</footer>
<!--subfooter start from here -->

<div class="copyright">
    <div class="container">
        <div class="col-md-6">
            <p>© 2017 -  Amazon</p>
        </div>
        <div class="col-md-6">
            <ul class="bottom_ul">
                <li><a href="#">About us</a></li>
                <li><a href="#">Blog</a></li>
                <li><a href="#">Faq's</a></li>
                <li><a href="#">Contact us</a></li>
                <li><a href="#">Site Map</a></li>
            </ul>
        </div>
    </div>
</div>

    
    <!--scripts loaded here-->





</body>

</html>
