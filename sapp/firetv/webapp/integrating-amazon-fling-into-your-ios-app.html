<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Integrating Amazon Fling into your iOS App | Fling SDK</title>
    
    <base target="_self">
    <meta name="description" content="This service provides an asynchronous discovery and control mechanism for your iOS app in the form of a framework. See Understanding the Amazon Fling Service for a high-level overview... " />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" value="notranslate">
    <link rel="icon"  type="image/x-icon" href="favicon.ico">
<!--
    Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance with the License. A copy of the License is located at http://aws.amazon.com/apache2.0/ or in the "license" file accompanying this file. This file is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. This site also includes third-party software subject to various copyrights. The licenses for these third party components are referenced in the NOTICE file.
-->

    <!-- FontAwesome -->
   <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <!-- jQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <!-- Navgoco -->
    <script type="text/javascript" src="assets/js/jquery.navgoco.min.js"></script>
    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- TOC generator-->
    <script src="assets/js/toc.js"></script>
    <!-- Anchor JS -->
    
        <script src="assets/js/anchor.min.js"></script>
    

    <script>
        $( document ).ready(function() {
            $("#docnavsidebar").navgoco({
                caretHtml: '',
                accordion: false,
                openClass: 'open', // open
                save: true,
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 300,
                    easing: 'swing'
                }
            });
            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#docnavsidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#docnavsidebar").navgoco('toggle', true);
            });
        });

    </script>
    <script src="assets/js/customscripts.js"></script>

    <script>
        $(document).ready(function() {
            $('[data-toggle=offcanvas]').click(function() {
                $('.row-offcanvas').toggleClass('active');
            });
        });
    </script>


    <!--Bootstrap -->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <style>
        ul#markdown-toc::before  {
        content: "Table of Contents"
         }
    </style>

</head>
<body class="default">
<div class="page-container">


    <!-- Top Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container topnavlinks">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="fa fa-bars fa-2x"></span>
                </button>
                <button type="button" class="navbar-toggle toggle-sidebar-button"  data-toggle="offcanvas" data-target=".sidebar-nav">
                    <span class="sidebarToggle fa fa-columns fa-2x"></span>
                </button>

                <a class="navbar-brand noCrossRef" href="https://developer.amazon.com/">
                    <img class="navbar-logo" src="amazonlogowhite.png"/>
            </div>

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-left">

                    <!-- single item nav items appear here -->

                    
                    
                    
                    
                    <li><a href="index.html">Documentation Home</a></li>
                    
                    
                    <li><a href="https://github.com/amzn/appstore-alexa-docs/issues" class="noCrossRef">Log Doc Issue</a></li>
                    <li><a target="_blank" href="https://github.com/amzn/appstore-alexa-docs/blob/github-docs/_docs/firetv/fling/integrating-amazon-fling-into-your-ios-app.md" class="editButton noCrossRef"><i class="fa fa-github fa-lg"></i> Edit on GitHub</a></li>
                    
                    <li><a href="https://forums.developer.amazon.com/spaces/66/index.html" class="editButton noCrossRef">Fling SDK Forum</a></li>
                    
                    
                    

                    <!-- drop-down nav items appear here -->

                    


                </ul>

                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <!--start search -->
                        <!--
                        <div id="search-demo-container">
                            <form action="search.html" method="get">
                                <input type="text" id="search-input" placeholder="Global Search ..." name="query">
                            </form>
                        </div>
                        -->
                        <!-- end search-->
                    </li>
                </ul>
            </div>

        </div>


        <!-- /.container -->
    </nav>


<div class="container">
        <div class="row row-offcanvas row-offcanvas-left">

            <!-- sidebar -->
            <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">

                


<div class="mydocsidebar">
<div class="sidebar-inner">
<!-- search bar - uses Lunr.js  -->

<div class="sidebarSearchBar">
<form action="search-fling.html" method="get">
  <div class="input-group search">
    <input type="text" id="search-box" name="query" class="form-control" placeholder="Product Search ...">
    <div class="input-group-btn">
      <button class="btn btn-default" type="submit" value="search">
        <i class="glyphicon glyphicon-search"></i>
      </button>
    </div>
  </div>
</form>
</div>

<!-- end search bar -->


<div class="productTitle">Fling SDK</div>
<p class="external">
    <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
</p>



    <ul id="docnavsidebar" class="docnav">
    
    <li class="level1"><a href="#">Fling Overview</a>
        <ul>
            

            
            
            <li class="level1items"><a href="understanding-the-amazon-fling-service.html">Understanding the Amazon Fling Service</a></li>
            
            

            

            

            
            
            <li class="level1items"><a  class="noCrossRef" href="https://developer.amazon.com/public/resources/development-tools/sdk">Download the Fling SDK</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="amazon-fling-frequently-asked-questions.html">Amazon Fling Frequently Asked Questions</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">Settting Up Fling</a>
        <ul>
            

            
            
            <li class="level1items"><a href="setting-up-your-amazon-fling-development-environment-for-android.html">Setting Up Your Amazon Fling Development Environment for Android</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="setting-up-your-amazon-fling-development-environment-for-ios.html">Setting Up your Amazon Fling Development Environment for iOS</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">Integrating Fling with Android, iOS, and Fire TV Apps</a>
        <ul>
            

            
            
            <li class="level1items"><a href="integrating-amazon-fling-into-your-android-app.html">Integrating Amazon Fling into Your Android App</a></li>
            
            

            

            

            
            
            <li class="level1items open"><a href="integrating-amazon-fling-into-your-ios-app.html">Integrating Amazon Fling into your iOS App</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="integrating-amazon-fling-into-your-fire-tv-app.html">Integrating Amazon Fling SDK into your Fire TV App</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="using-amazon-fling-with-android-mediarouter.html">Using Amazon Fling with Android MediaRouter</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="working-with-built-in-receiver-on-fire-tv.html">Working with the Built-in Receiver on the Fire TV Platform</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">Integrating Fling with Google Cast Apps</a>
        <ul>
            

            
            
            <li class="level1items"><a href="integrating-amazon-fling-with-cast.html">Integrating Amazon Fling with Apps that Use Google Cast</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="integrating-amazon-fling-with-an-existing-android-cast-app.html">Integrating Amazon Fling with an Existing Android App that Uses Google Cast</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="integrating-amazon-fling-with-an-existing-ios-cast-app.html">Integrating Amazon Fling with an Existing iOS App that uses Google Cast</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">Fling UX</a>
        <ul>
            

            
            
            <li class="level1items"><a href="designing-amazon-fling-ux.html">Designing Amazon Fling UX</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">Remote Install</a>
        <ul>
            

            
            
            <li class="level1items"><a href="remote-install.html">Remote Install</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="android-remote-install.html">Integrating Remote Install into Your Android App</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="ios-remote-install.html">Integrating Remote Install into Your iOS App</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">Unity Plugins</a>
        <ul>
            

            
            
            <li class="level1items"><a href="unity-controller-plugin.html">Integrating the Amazon Fling Controller In Your Games</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="unity-player-plugin.html">Integrating the Amazon Fling Player In Your Games</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">API Docs</a>
        <ul>
            

            
            
            <li class="level1items"><a  class="noCrossRef" href="https://developer.amazon.com/public/binaries/content/assets/javadoc/whisperplay/javadocs/reference/packages.html">Android API Documentation</a></li>
            
            

            

            

            
            
            <li class="level1items"><a  class="noCrossRef" href="https://developer.amazon.com/public/binaries/content/assets/javadoc/whisperplay/objc-apidocs/index.html">iOS API Documentation</a></li>
            
            

            

            
        </ul>

        

    </li>
</ul>

<hr class="resourceSeparator"></hr>
<div class="relatedResources">Related Resources</div>
<ul id="entrypages">
        
        <li><a class="noCrossRef" href="/getting-started-developing-apps-and-games-for-amazon-fire-tv.html">Fire TV</a></li>
        
        <li><a class="noCrossRef" href="/fire-app-builder-overview.html">Fire App Builder</a></li>
        
        <li><a class="noCrossRef" href="/appstore-understanding-submission">Appstore Publishing</a></li>
        
        <li><a class="noCrossRef" href="/getting-started-with-iap">In-App Purchasing API</a></li>
        
        <li><a class="noCrossRef" href="/understanding-the-amazon-fling-service">Fling SDK</a></li>
        
        <li><a class="noCrossRef" href="">Developer Portal Forums</a></li>
        
    </li>
</ul>
</div>
</div>
<script>$("li.open").parents('li').toggleClass("open");</script>






            </div>

            <!-- main area -->
            <div class="col-xs-12 col-sm-9 main">

                    <div class="subtitle"><a href="http://developer.amazon.com" class="noCrossRef productSubtitle"> Home</a> > <a href="index.html" class="noCrossRef productSubtitle"> Documentation</a> > Fling SDK </div>

                    <h1>Integrating Amazon Fling into your iOS App</h1>

                    <p>This service provides an asynchronous discovery and control mechanism for your iOS app in the form of a framework. See <a href="understanding-the-amazon-fling-service.html">Understanding the Amazon Fling Service</a> for a high-level overview of the features and functions this service provides. See also the “FlingSample” sample app, part of the SDK, for a sample controller implementation for iOS.</p>

<p>Before you start, make sure you’ve set up your development environment. See <a href="setting-up-your-amazon-fling-development-environment-for-ios.html">Setting Up your Amazon Fling Development Environment for iOS</a>  for details.</p>

<ul id="markdown-toc">
  <li><a href="#initializing-and-suspending-the-controller-app" id="markdown-toc-initializing-and-suspending-the-controller-app">Initializing and Suspending the Controller App</a></li>
  <li><a href="#implementing-discovery-callbacks" id="markdown-toc-implementing-discovery-callbacks">Implementing Discovery Callbacks</a></li>
  <li><a href="#presenting-remote-players-to-the-user" id="markdown-toc-presenting-remote-players-to-the-user">Presenting Remote Players to the User</a></li>
  <li><a href="#working-with-bftask" id="markdown-toc-working-with-bftask">Working with BFTask</a></li>
  <li><a href="#connecting-to-and-disconnecting-from-a-remote-player" id="markdown-toc-connecting-to-and-disconnecting-from-a-remote-player">Connecting to and Disconnecting from a Remote Player</a></li>
  <li><a href="#controlling-playback" id="markdown-toc-controlling-playback">Controlling Playback</a></li>
  <li><a href="#next-steps" id="markdown-toc-next-steps">Next Steps</a></li>
</ul>

<h2 id="initializing-and-suspending-the-controller-app">Initializing and Suspending the Controller App</h2>

<p>When your iOS controller app loads, for example in the <code class="highlighter-rouge">ViewController::viewDidLoad</code> method, call <code class="highlighter-rouge">DiscoveryController::</code><code class="highlighter-rouge">searchPlayerWithId</code> to initialize the underlying framework and start the discovery. Call <code class="highlighter-rouge">DiscoveryController::resume</code> every time the app comes to the foreground, that is, in the <code class="highlighter-rouge">applicationDidBecomeActive</code> lifecycle event of the <code class="highlighter-rouge">UIApplicationDelegate</code> implementation.</p>

<div class="language-objective_c highlighter-rouge"><pre class="highlight"><code><span class="k">@implementation</span> <span class="nc">AppDelegate</span>
<span class="p">...</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">applicationDidBecomeActive</span><span class="o">:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="n">application</span> <span class="p">{</span>
    <span class="n">id</span> <span class="n">myViewController</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">findViewController</span><span class="p">];</span>
    <span class="p">[</span><span class="n">myViewController</span> <span class="nf">resume</span><span class="p">];</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="k">@implementation</span> <span class="nc">ViewController</span>
<span class="p">...</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
<span class="p">...</span>
    <span class="n">mController</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DiscoveryController</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="p">[</span><span class="n">mController</span> <span class="nf">searchPlayerWithId</span> <span class="p">:</span> <span class="s">@"amzn.thin.pl"</span> <span class="nf">andListener</span> <span class="p">:</span> <span class="n">self</span><span class="p">];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">resume</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">mController</span> <span class="nf">resume</span><span class="p">];</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The debug logging is disabled by default. To enable the debug logging add the parameter <code class="highlighter-rouge">andEnableLogs</code> set to <code class="highlighter-rouge">YES</code> when calling <code class="highlighter-rouge">searchPlayerWithId</code>. Once the underlying framework is initialized, other operations such as player discovery and media playback and control are possible.</p>

<p>When the controller app is to be suspended such as when the user locks the screen, your app must also suspend the underlying framework. Call <code class="highlighter-rouge">DiscoveryController::close</code> in the <code class="highlighter-rouge">applicationWillResignActive</code> lifecycle event of the <code class="highlighter-rouge">UIApplicationDelegate</code> implementation to suspend the underlying framework.</p>

<div class="language-objective_c highlighter-rouge"><pre class="highlight"><code><span class="k">@implementation</span> <span class="nc">AppDelegate</span>
<span class="p">...</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">applicationWillResignActive</span><span class="o">:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="n">application</span> <span class="p">{</span>
    <span class="n">id</span> <span class="n">myViewController</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">findViewController</span><span class="p">];</span>
    <span class="p">[</span><span class="n">myViewController</span> <span class="nf">suspend</span><span class="p">];</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="k">@implementation</span> <span class="nc">ViewController</span>
<span class="p">...</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">suspend</span> <span class="p">{</span>
    <span class="c1">// Make sure that MediaPlayerStatusListener is removed before suspending.
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">mCurrentPlayer</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">mCurrentPlayer</span> <span class="nf">removeStatusListener</span><span class="p">:</span><span class="n">self</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">mController</span> <span class="nf">close</span><span class="p">];</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="implementing-discovery-callbacks">Implementing Discovery Callbacks</h2>

<p>As part of your app’s initialization, the component that creates the <code class="highlighter-rouge">DiscoveryController</code> instance should also specify the callback receiver. This object implements the <code class="highlighter-rouge">DiscoveryListener</code> interface. The object is passed to the underlying framework in the <code class="highlighter-rouge">DiscoveryController::</code><code class="highlighter-rouge">searchPlayerWithId</code> call. Discovery is an ongoing process as long as the <code class="highlighter-rouge">DiscoveryController</code> object is live.</p>

<div class="language-objective_c highlighter-rouge"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">ViewController</span> <span class="p">:</span> <span class="nc">UIViewController</span><span class="o">&lt;</span><span class="n">DiscoveryListener</span><span class="o">&gt;</span>
<span class="p">...</span>
<span class="k">@implementation</span> <span class="nc">ViewController</span>
<span class="p">...</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">deviceDiscovered</span><span class="o">:</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RemoteMediaPlayer</span><span class="o">&gt;</span><span class="p">)</span><span class="n">device</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">mDevices</span> <span class="nf">addObject</span><span class="p">:</span><span class="n">device</span><span class="p">];</span>
    <span class="c1">// Update UI
</span><span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">deviceLost</span><span class="o">:</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RemoteMediaPlayer</span><span class="o">&gt;</span><span class="p">)</span><span class="n">device</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">mDevices</span> <span class="nf">removeObject</span><span class="p">:</span><span class="n">device</span><span class="p">];</span>
    <span class="c1">// Update UI
</span><span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">discoveryFailure</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The remote players are represented as <code class="highlighter-rouge">RemoteMediaPlayer</code> objects. Through this interface, your controller app can control the media playback on the remote player.</p>

<h2 id="presenting-remote-players-to-the-user">Presenting Remote Players to the User</h2>

<p>Once the players in the vicinity are discovered, the controller app should present the friendly names of to the user.</p>

<div class="language-objective_c highlighter-rouge"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">pickerView</span><span class="p">:(</span><span class="n">UIPickerView</span> <span class="o">*</span><span class="p">)</span><span class="nv">pickerView</span>
             <span class="nf">titleForRow</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">row</span>
            <span class="nf">forComponent</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">component</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pickerView</span> <span class="o">==</span> <span class="n">devicePickerView</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">row</span> <span class="o">&lt;</span> <span class="p">[</span><span class="n">mDevices</span> <span class="nf">count</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">id</span><span class="o">&lt;</span><span class="n">RemoteMediaPlayer</span><span class="o">&gt;</span> <span class="n">dev</span> <span class="o">=</span> <span class="p">[</span><span class="n">mDevices</span> <span class="nf">objectAtIndex</span><span class="p">:</span><span class="n">row</span><span class="p">];</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">dev</span> <span class="nf">name</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="working-with-bftask">Working with BFTask</h2>

<p><code class="highlighter-rouge">BFTask</code> is a class in the Bolts mobile development framework. Bolts makes it easier to work with asynchronous operations without blocking the UI thread. Our SDK for iOS uses Bolts to handle asynchronous tasks.</p>

<p>A <code class="highlighter-rouge">BFTask</code> object represents the result of an asynchronous method. Using <code class="highlighter-rouge">BFTask</code>, you can wait for an asynchronous method to return a value, and then do something with that value after it has returned. When you are working with our SDK for iOS, it is important to remember that methods that return <code class="highlighter-rouge">BFTask</code> are asynchronous.</p>

<p>Every <code class="highlighter-rouge">BFTask</code> has a method called <code class="highlighter-rouge">continueWithBlock:</code> that takes a continuation block. A continuation is a block that will be executed when the task is complete. In many cases, you only want to do more work if the previous task was successful, and propagate any errors to be dealt with later. To do this, use the <code class="highlighter-rouge">continueWithSuccessBlock:</code> method instead of <code class="highlighter-rouge">continueWithBlock:</code>. Note that you must return either <code class="highlighter-rouge">BFTask</code> or nil in every <code class="highlighter-rouge">continueWithBlock:</code> and <code class="highlighter-rouge">continueWithSucessBlock:</code>.</p>

<p>For complete documentation on Bolts, see <a href="https://github.com/BoltsFramework/Bolts-iOS" title="Bolts-iOS">Bolts-iOS</a> on GitHub. Clicking on this link will send you outside the Amazon Developer Portal.</p>

<h2 id="connecting-to-and-disconnecting-from-a-remote-player">Connecting to and Disconnecting from a Remote Player</h2>

<p>After the user picks the player from the list of available players on Fire TV devices, your controller app is ready to interact with that remote player. To implement this interaction, the app needs to know the current player status and listen for changes to that status. Status updates are presented to the controller app in the form of callbacks.</p>

<p>Your callback receiver implements the <code class="highlighter-rouge">MediaPlayerStatusListener</code> interface. This callback provides the current status of the player in an <code class="highlighter-rouge">MediaPlayerStatus</code> object. The current state is returned by the <code class="highlighter-rouge">state</code> selector, and the <code class="highlighter-rouge">condition</code> selector returns extra information about the state.</p>

<div class="language-objective_c highlighter-rouge"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">ViewController</span> <span class="p">:</span> <span class="nc">UIViewController</span><span class="o">&lt;</span><span class="n">MediaPlayerStatusListener</span><span class="o">&gt;</span>
<span class="p">...</span>
<span class="k">@implementation</span> <span class="nc">ViewController</span>
<span class="p">...</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">onStatusChange</span><span class="o">:</span><span class="p">(</span><span class="n">MediaPlayerStatus</span> <span class="o">*</span><span class="p">)</span><span class="n">status</span> <span class="n">positionChangedTo</span><span class="o">:</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">position</span> <span class="p">{</span>
    <span class="c1">// Update UI with status
</span><span class="p">}</span>
</code></pre>
</div>

<p>To receive the callbacks the app must add a status update listener object to the remote player object. Depending on the logic, the app should disconnect from the last player.</p>

<div class="language-objective_c highlighter-rouge"><pre class="highlight"><code><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">connectToPlayer</span><span class="p">:(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">RemoteMediaPlayer</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">device</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mCurrentPlayer</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">mCurrentPlayer</span> <span class="o">=</span> <span class="n">device</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">device</span> <span class="o">!=</span> <span class="n">mCurrentPlayer</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[[</span><span class="n">mCurrentPlayer</span> <span class="nf">removeStatusListener</span><span class="p">:</span><span class="n">self</span><span class="p">]</span> <span class="nf">continueWithBlock</span><span class="p">:</span><span class="o">^</span><span class="n">id</span><span class="p">(</span><span class="n">BFTask</span> <span class="o">*</span><span class="n">task</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Indicate error
</span>            <span class="p">}</span>
            <span class="n">mCurrentPlayer</span> <span class="o">=</span> <span class="n">device</span><span class="p">;</span>
            <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
        <span class="p">}];</span>
    <span class="p">}</span>
    <span class="p">[[</span><span class="n">mCurrentPlayer</span> <span class="nf">addStatusListener</span><span class="p">:</span><span class="n">self</span><span class="p">]</span> <span class="nf">continueWithBlock</span><span class="p">:</span><span class="o">^</span><span class="n">id</span><span class="p">(</span><span class="n">BFTask</span> <span class="o">*</span><span class="n">task</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Indicate error
</span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// UI update to show connection establishment
</span>        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
<span class="p">}</span>
</code></pre>
</div>

<p>You should disconnect from the current player when the status updates are not needed.</p>

<div class="language-objective_c highlighter-rouge"><pre class="highlight"><code><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">disconnectFromCurrentPlayer</span> <span class="p">{</span>
    <span class="p">[[</span><span class="n">mCurrentPlayer</span> <span class="nf">removeStatusListener</span> <span class="p">:</span> <span class="n">self</span><span class="p">]</span> <span class="nf">continueWithBlock</span><span class="p">:</span><span class="o">^</span><span class="n">id</span><span class="p">(</span><span class="n">BFTask</span> <span class="o">*</span><span class="n">task</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Indicate error
</span>        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="controlling-playback">Controlling Playback</h2>

<p>Once the player connection is established, your controller app can play and control media playback on that player. The <code class="highlighter-rouge">RemoteMediaPlayer</code> object provides local methods to control the playback and volume. All the control actions are asynchronous and your controller app should provide success and failure handler callbacks to each of the control methods if desired. Please note that these callbacks are not on the UI thread and the app must dispatch any UI updates on the main thread.</p>

<p>Examples of control actions are below:</p>

<div class="language-objective_c highlighter-rouge"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">playNewMedia</span> <span class="p">:</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">metadata</span> <span class="o">:</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">url</span> <span class="p">{</span>
     <span class="p">[[</span><span class="n">mCurrentPlayer</span> <span class="nf">setMediaSourceToURL</span> <span class="p">:</span> <span class="n">url</span>
                                 <span class="nf">metaData</span> <span class="p">:</span> <span class="n">metadata</span>
                                 <span class="nf">autoPlay</span> <span class="p">:</span> <span class="nb">YES</span> <span class="c1">// start playback immediately
</span>                      <span class="nf">andPlayInBackground</span> <span class="p">:</span> <span class="nb">NO</span>  <span class="c1">// play in foreground
</span>    <span class="p">]</span> <span class="n">continueWithBlock</span><span class="o">:^</span><span class="n">id</span><span class="p">(</span><span class="n">BFTask</span> <span class="o">*</span><span class="n">task</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Indicate error
</span>        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
<span class="p">}</span>
<span class="o">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="n">goBack10s</span> <span class="o">:</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">sender</span> <span class="p">{</span>
    <span class="p">[[[</span><span class="n">mCurrentPlayer</span> <span class="nf">getPosition</span><span class="p">]</span> <span class="nf">continuteWithSuccessBlock</span><span class="p">:</span><span class="o">^</span><span class="n">id</span><span class="p">(</span><span class="n">BFTask</span> <span class="o">*</span><span class="n">task</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">long</span> <span class="kt">long</span> <span class="n">toPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span><span class="p">.</span><span class="n">result</span> <span class="nf">longlongValue</span><span class="p">];</span>
        <span class="n">toPos</span> <span class="o">-=</span> <span class="mi">10000</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">toPos</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">toPos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">mCurrentPlayer</span> <span class="nf">seekToPosition</span><span class="p">:</span><span class="n">toPos</span> <span class="nf">andMode</span><span class="p">:</span><span class="n">ABSOLUTE</span><span class="p">];</span>
    <span class="p">}]</span> <span class="nf">continueWithBlock</span><span class="p">:</span><span class="o">^</span><span class="n">id</span><span class="p">(</span><span class="n">BFTask</span> <span class="o">*</span><span class="n">task</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Indicate error
</span>        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="next-steps">Next Steps</h2>

<p>To create a custom player for Fire TV, see <a href="integrating-amazon-fling-into-your-fire-tv-app.html">Integrating Amazon Fling into your Fire TV Application</a>.</p>

<p>If you are modifying an existing Google Cast app on iOS to support flinging to Amazon Fire TV, see <a href="integrating-amazon-fling-with-an-existing-ios-cast-app.html">Integrating Amazon Fling with an Existing iOS Cast App</a>.</p>

<p>Please refer to <a href="designing-amazon-fling-ux.html">Designing Amazon Fling UX</a> for guidelines on how to design the user interface of your app.</p>




            </div>
        </div><!--/.container-->


    </div><!--/.page-container-->
    
    <div class="footertop">
    <div class="container">
        <div class="col-md-6">
            <p></p>
        </div>
        <div class="col-md-6">
            <ul class="bottom_ul">
        </div>
    </div>
</div>

<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-4 col-sm-6 footerleft ">
                <div class="logofooter"> About the Developer Portal</div>
                <p>The Amazon Developer Portal provides documentation for developers creating apps for the Amazon
                    appstore, including Alexa skills. Apps include streaming media apps, game apps, skills, and more. </p>

            </div>
            <div class="col-md-2 col-sm-6 paddingtop-bottom">
                <h6 class="heading7">Links</h6>
                <ul class="footer-ul">
                    <li><a class="noCrossRef" href="https://developer.amazon.com/"> Developer Portal</a></li>
                    <li><a class="noCrossRef" href="/index.html">Documentation Home</a></li>
                    <li class="noCrossRef"><a href="https://developer.amazon.com/support"> Support</a></li>
                    <li class="noCrossRef"><a href="https://aws.amazon.com/documentation/"> AWS docs</a></li>
                    <li class="noCrossRef"><a href="https://www.amazon.com/mobile-apps/b?ie=UTF8&node=2350149011"> Amazon Appstore</a></li>
                </ul>
            </div>

            <div class="col-md-3 col-sm-6 paddingtop-bottom">
                <h6 class="heading7">Amazon News</h6>
                <ul class="footer-ul">
                    <li class="noCrossRef"><a href="https://developer.amazon.com/blogs"> Blog</a></li>
                    <li class="noCrossRef"><a href="https://www.youtube.com/channel/UCT9ApARFgQJOeqD-ygmxnJQ"> YouTube</a></li>
                    <li class="noCrossRef"><a href="https://twitter.com/AmazonAppDev"> Twitter</a></li>
                    <li class="noCrossRef"><a href="http://phx.corporate-ir.net/phoenix.zhtml?p=irol-mediahome&c=176060"> Amazon Press Room</a></li>
                </ul>
            </div>

            <div class="col-md-3 col-sm-6 paddingtop-bottom">
                <h6 class="heading7">Forums</h6>
                <ul class="footer-ul">
                    <li class="noCrossRef"><a href="https://forums.developer.amazon.com/spaces/23/index.html"> Alexa Skills Kit</a></li>
                    <li class="noCrossRef"><a href="https://forums.developer.amazon.com/spaces/33/index.html"> Smart Home Skill API</a></li>
                    <li class="noCrossRef"><a href="https://forums.developer.amazon.com/spaces/38/index.html"> Alexa Voice Service</a></li>
                    <li class="noCrossRef"><a href="https://forums.developer.amazon.com/spaces/167/index.html"> Appstore</a></li>
                    <li class="noCrossRef"><a href="https://forums.developer.amazon.com/spaces/12/index.html"> Underground</a></li>
                    <li class="noCrossRef"><a href="https://forums.developer.amazon.com/spaces/166/index.html"> Fire Devices</a></li>
                    <li class="noCrossRef"><a href="https://forums.developer.amazon.com/spaces/61/index.html"> Dash</a></li>
                </ul>
            </div>
        </div>
    </div>
    </div>
</footer>
<!--subfooter start from here -->

<div class="copyright">
    <div class="container">
        <div class="col-md-12">
            <p>© 1996-2017, Amazon.com, Inc. or its affiliates</p>
        </div>
    </div>
</div>

    
    <!--scripts loaded here-->



</body>

</html>
