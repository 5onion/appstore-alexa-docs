<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Integrate Entitlements Into Web Apps | In-App Purchasing</title>
    
    <base target="_self">
    <meta name="description" content="Entitlement represents a one-time purchase to unlock access to features or content within an app or game.  Entitled Content Overview? Sample Implementation  <a... " />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" value="notranslate">
    <link rel="icon"  type="image/x-icon" href="favicon.ico">
<!--
    Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance with the License. A copy of the License is located at http://aws.amazon.com/apache2.0/ or in the "license" file accompanying this file. This file is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. This site also includes third-party software subject to various copyrights. The licenses for these third party components are referenced in the NOTICE file.
-->

    <!-- FontAwesome -->
   <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <!-- jQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <!-- Navgoco -->
    <script type="text/javascript" src="assets/js/jquery.navgoco.min.js"></script>
    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- Anchor JS -->
    
        <script src="assets/js/anchor.min.js"></script>
    

    <script>
        $( document ).ready(function() {
            $("#docnavsidebar").navgoco({
                caretHtml: '',
                accordion: false,
                openClass: 'open', // open
                save: true,
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 300,
                    easing: 'swing'
                }
            });
            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#docnavsidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#docnavsidebar").navgoco('toggle', true);
            });
        });

    </script>
    <script src="assets/js/customscripts.js"></script>

    <script>
        $(document).ready(function() {
            $('[data-toggle=offcanvas]').click(function() {
                $('.row-offcanvas').toggleClass('active');
            });
        });
    </script>


    <!--Bootstrap -->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <style>
        ul#markdown-toc::before  {
        content: "Table of Contents"
         }
    </style>

</head>
<body class="default">
<div class="page-container">


    <!-- Top Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container topnavlinks">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="fa fa-bars fa-2x"></span>
                </button>
                <button type="button" class="navbar-toggle toggle-sidebar-button"  data-toggle="offcanvas" data-target=".sidebar-nav">
                    <span class="sidebarToggle fa fa-columns fa-2x"></span>
                </button>

                <a class="navbar-brand noCrossRef" href="https://developer.amazon.com/">
                    <img class="navbar-logo" src="amazonlogowhite.png"/>
            </div>

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-left">

                    <!-- single item nav items appear here -->

                    
                    
                    
                    
                    <li><a href="index.html">Documentation Home</a></li>
                    
                    
                    <li><a href="https://github.com/amzn/appstore-alexa-docs/issues" class="noCrossRef">Log Doc Issue</a></li>
                    <li><a target="_blank" href="https://github.com/amzn/appstore-alexa-docs/blob/github-docs/_docs/firetv/fling/iap-entitlements-webapps.md" class="editButton noCrossRef"><i class="fa fa-github fa-lg"></i> Edit on GitHub</a></li>
                    
                    <li><a href="https://forums.developer.amazon.com/spaces/70/index.html" class="editButton noCrossRef">In-App Purchasing Forum</a></li>
                    
                    
                    

                    <!-- drop-down nav items appear here -->

                    


                </ul>

                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <!--start search -->
                        <!--
                        <div id="search-demo-container">
                            <form action="search.html" method="get">
                                <input type="text" id="search-input" placeholder="Global Search ..." name="query">
                            </form>
                        </div>
                        -->
                        <!-- end search-->
                    </li>
                </ul>
            </div>

        </div>


        <!-- /.container -->
    </nav>



<div class="container">
        <div class="row row-offcanvas row-offcanvas-left">

            <!-- sidebar -->
            <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">

                


<div class="mydocsidebar">
<div class="sidebar-inner">
<!-- search bar - uses Lunr.js  -->

<div class="sidebarSearchBar">
<form action="search-in_app_purchasing.html" method="get">
  <div class="input-group search">
    <input type="text" id="search-box" name="query" class="form-control" placeholder="Product Search ...">
    <div class="input-group-btn">
      <button class="btn btn-default" type="submit" value="search">
        <i class="glyphicon glyphicon-search"></i>
      </button>
    </div>
  </div>
</form>
</div>

<!-- end search bar -->


<div class="productTitle">In-App Purchasing API</div>
<p class="external">
    <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
</p>



    <ul id="docnavsidebar" class="docnav">
    
    <li class="level1"><a href="#">Get Started</a>
        <ul>
            

            
            
            <li class="level1items"><a href="whats-new-in-in-app-purchasing.html">What is New in In-App Purchasing</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="understanding-in-app-purchasing.html">About In-App Purchasing</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="iap-faqs.html">IAP FAQs</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="best-practices-ui-and-ux-design-guidelines.html">UX Design Guidelines for IAP</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="deep-linking-to-the-amazon-client.html">Link to Amazon from within Your App</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="submitting-iap-items.html">Submit Single In-App Items with Developer Console</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">Implement IAP for Android Apps</a>
        <ul>
            

            
            
            <li class="level1items"><a href="getting-started-with-iap.html">Get Started with IAP</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="implementing-iap.html">Implement In-App Purchasing</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="obfuscating-the-code.html">Obfuscate The App Code</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="migrate-iapv1-apps-to-iapv2.html">Migrate from IAP v1.0 to IAP v2.0</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="migrating-from-googles-iab-to-amazons-iap.html">Migrate from Google Play IAB v3.0 to Amazon IAP v2.0</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">Test IAP for Android Apps</a>
        <ul>
            

            
            
            <li class="level1items"><a href="testing-iap.html">Testing Overview</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="installing-and-configuring-app-tester.html">Install and Configure the App Tester</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="app-tester-user-guide.html">App Tester User Guide</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="test-cases-for-iap.html">Design and Execute Test Cases for IAP</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="verifying-receipts-in-iap.html">RVS for Android Apps</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">Implement IAP for Web Apps</a>
        <ul>
            

            
            
            <li class="level1items"><a href="iap-api-for-webapps-overview.html">Overview of IAP API for Web Apps</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="iap-consumables-webapps.html">Integrate Consumables Into Web Apps</a></li>
            
            

            

            

            
            
            <li class="level1items open"><a href="iap-entitlements-webapps.html">Integrate Entitlements Into Web Apps</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="iap-subscriptions-webapps.html">Integrate Subscriptions Into Web Apps</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">Test IAP for Web Apps</a>
        <ul>
            

            
            
            <li class="level1items"><a href="iap-sdk-tester-for-webapps.html">IAP SDK Tester for Web Apps</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="verifying-receipts-in-iap-webapp.html">RVS for Web Apps</a></li>
            
            

            

            
        </ul>

        
    <li class="level1"><a href="#">Reference</a>
        <ul>
            

            
            
            <li class="level1items"><a href="in-app-purchasing-2.0-api-reference.html">In-App Purchasing API 2.0 Reference</a></li>
            
            

            

            
        </ul>

        

    </li>
</ul>

<hr class="resourceSeparator"></hr>
<div class="relatedResources">Other Resources</div>
<ul id="entrypages">
        
        <li><a class="noCrossRef" href="/getting-started-developing-apps-and-games-for-amazon-fire-tv.html">Fire TV</a></li>
        
        <li><a class="noCrossRef" href="/fire-app-builder-overview.html">Fire App Builder</a></li>
        
        <li><a class="noCrossRef" href="/getting-started-for-fire-tablets.html">Fire Tablets</a></li>
        
        <li><a class="noCrossRef" href="/fire-os-overview.html">Fire OS</a></li>
        
        <li><a class="noCrossRef" href="/environment.html">HTML5 Web API</a></li>
        
        <li><a class="noCrossRef" href="/cross-platform-plugins-landing-page.html">Cross Platform Engine Plugins</a></li>
        
        <li><a class="noCrossRef" href="/appstore-understanding-submission">Appstore Publishing</a></li>
        
        <li><a class="noCrossRef" href="/understanding-the-amazon-fling-service">Fling SDK</a></li>
        
        <li><a class="noCrossRef" href="/obtaining-an-access-token-for-the-developer-publishing-api">Developer Publishing API</a></li>
        
        <li><a class="noCrossRef" href="">Developer Portal Forums</a></li>
        
    </li>
</ul>
</div>
</div>
<script>$("li.open").parents('li').toggleClass("open");</script>






            </div>

            <!-- main area -->
            <div class="col-xs-12 col-sm-9 main">

                    <div class="subtitle"><a href="http://developer.amazon.com" class="noCrossRef productSubtitle"> Home</a> > <a href="index.html" class="noCrossRef productSubtitle"> Documentation</a> > In-App Purchasing </div>

                    <h1>Integrate Entitlements Into Web Apps</h1>

                    <p>Entitlement represents a one-time purchase to unlock access to features or content within an app or game.</p>

<ul id="markdown-toc">
  <li><a href="#entitled-content-overview" id="markdown-toc-entitled-content-overview">Entitled Content Overview?</a></li>
  <li><a href="#sample-implementation" id="markdown-toc-sample-implementation">Sample Implementation</a>    <ul>
      <li><a href="#buttonclicker-sample-code-entitlements" id="markdown-toc-buttonclicker-sample-code-entitlements">ButtonClicker Sample Code Entitlements</a></li>
    </ul>
  </li>
</ul>

<h2 id="entitled-content-overview">Entitled Content Overview?</h2>

<p>Entitled content includes any type of content that you sell within your app that requires access rights. This type of content is available anywhere the customer is logged into the Amazon Client. The entitled content does not expire. If Amazon needs to rescind the entitled content, your app will be notified via an observable event.</p>

<p>Customers purchase a specific entitlement only once. The entitled content is granted to the customer’s Amazon account. That entitled content is used to access the content from any eligible device the customer has linked to their account.</p>

<p>Entitled content typically include items such as:</p>

<ul>
  <li>Additional levels for a game</li>
  <li>Access to a previously purchased item like a magazine issue</li>
  <li>Unlocking functionality already in your app</li>
</ul>

<p>The PurchasingManager grants the entitlement; you do not have to do anything outside of initiating the purchase. Through the PurchasingManager you can retrieve purchase data and revoked entitlements to determine if a customer has an entitlement for a specific SKU.</p>

<figure><img class="docimage " src="docs/in_app_purchasing/entitled-content.png" alt="" /></figure>

<h2 id="sample-implementation">Sample Implementation</h2>

<p>The following sample code is an excerpt of the Button Clicker Sample App showing the relevant logic for integrating entitled content. In the app, button colors are purchasable entitled content items. The complete app and source code is provided as part of the Amazon Web App Resources.</p>

<h3 id="buttonclicker-sample-code-entitlements">ButtonClicker Sample Code Entitlements</h3>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
     * Button Clicker
     * Sample Implementation of the In-App Purchasing APIs
     * © 2013, Amazon.com, Inc. or its affiliates.
     * All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License").
     * You may not use this file except in compliance with the License.
     * A copy of the License is located at
     * http://aws.amazon.com/apache2.0/
     * or in the "license" file accompanying this file.
     * This file is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
     * implied.
     * See the License for the specific language governing permissions and limitations under the License.
     */</span>

    <span class="c1">// This is a simple model view controller setup to deal with</span>
    <span class="c1">// the fact that the onPurchaseResponse can get called at any</span>
    <span class="c1">// time.</span>
    <span class="c1">//</span>
    <span class="c1">// The fact that responses can come at any time is important to</span>
    <span class="c1">// understand when using the API. Your web app could have been</span>
    <span class="c1">// shut down prior to a receipt being delivered for instance. The</span>
    <span class="c1">// next time your application runs the receipt will be delivered</span>
    <span class="c1">// upon initializing the API in this case.</span>

    <span class="c1">// Model Data</span>

    <span class="kd">var</span> <span class="nx">activeButton</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">hasRedButton</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">hasGreenButton</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">initialize</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="c1">// Setup</span>

    <span class="kd">function</span> <span class="nx">initialize</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">amzn_wa</span><span class="p">.</span><span class="nx">enableApiTester</span><span class="p">(</span><span class="nx">amzn_wa_tester</span><span class="p">);</span>
        <span class="nx">refreshPageState</span><span class="p">();</span>

        <span class="c1">// Setup button press handlers</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">"#redButton"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">redButtonPressed</span><span class="p">();</span> <span class="p">});</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">"#greenButton"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">greenButtonPressed</span><span class="p">();</span> <span class="p">});</span>

        <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"amazonPlatformReady"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">oData</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Ensure we can call the IAP API</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">amzn_wa</span><span class="p">.</span><span class="nx">IAP</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Amazon In-App-Purchasing only works with Apps from the Appstore"</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// Registers the appropriate callback functions</span>
                <span class="nx">amzn_wa</span><span class="p">.</span><span class="nx">IAP</span><span class="p">.</span><span class="nx">registerObserver</span><span class="p">({</span>
                        <span class="c1">// Called the the IAP API is available</span>
                        <span class="s1">'onSdkAvailable'</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">isSandboxMode</span><span class="p">)</span> <span class="p">{</span>
                                <span class="c1">// In a production application this should trigger either</span>
                                <span class="c1">// shutting down IAP functionality or redirecting to some</span>
                                <span class="c1">// page explaining that you should purchase this application</span>
                                <span class="c1">// from the Amazon Appstore.</span>
                                <span class="c1">//</span>
                                <span class="c1">// Not checking can leave your application in a state that</span>
                                <span class="c1">// is vulnerable to attacks. See the supplied documention</span>
                                <span class="c1">// for additional information.</span>
                                <span class="nx">alert</span><span class="p">(</span><span class="s2">"Running in test mode"</span><span class="p">);</span>
                            <span class="p">}</span>

                            <span class="c1">// You should call getPurchaseUpdates to get any purchases</span>
                            <span class="c1">// that could have been made in a previous run.</span>
                            <span class="nx">amzn_wa</span><span class="p">.</span><span class="nx">IAP</span><span class="p">.</span><span class="nx">getPurchaseUpdates</span><span class="p">(</span><span class="nx">amzn_wa</span><span class="p">.</span><span class="nx">IAP</span><span class="p">.</span><span class="nx">Offset</span><span class="p">.</span><span class="nx">BEGINNING</span><span class="p">);</span>
                        <span class="p">},</span>

                        <span class="c1">// Called as response to getUserId</span>
                        <span class="s1">'onGetUserIdResponse'</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span> <span class="p">{},</span>

                        <span class="c1">// Called as response to getItemData</span>
                        <span class="s1">'onItemDataResponse'</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{},</span>

                        <span class="c1">// Called as response to puchaseItem</span>
                        <span class="s1">'onPurchaseResponse'</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="nx">onPurchaseResponse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span> <span class="p">},</span>

                        <span class="c1">// Called as response to getPurchaseUpdates</span>
                        <span class="s1">'onPurchaseUpdatesResponse'</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span> <span class="p">{</span> <span class="nx">onPurchaseUpdatesResponse</span><span class="p">(</span><span class="nx">resp</span><span class="p">);</span> <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="c1">// Controller</span>

    <span class="c1">// Excercises entitlements</span>
    <span class="kd">function</span> <span class="nx">redButtonPressed</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">hasRedButton</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">activeButton</span> <span class="o">=</span> <span class="s2">"red"</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">buyButton</span><span class="p">(</span><span class="s2">"sample.redbutton"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">refreshPageState</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Excercises entitlements</span>
    <span class="kd">function</span> <span class="nx">greenButtonPressed</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">hasGreenButton</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">activeButton</span> <span class="o">=</span> <span class="s2">"green"</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">buyButton</span><span class="p">(</span><span class="s2">"sample.greenbutton"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">refreshPageState</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">buyButton</span><span class="p">(</span><span class="nx">buttonName</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">amzn_wa</span><span class="p">.</span><span class="nx">IAP</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="s2">"You cannot buy this button, Amazon In-App-Purchasing works only with Apps from the Appstore."</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="s2">"Calling purchaseItem: "</span> <span class="o">+</span> <span class="nx">buttonName</span><span class="p">);</span>
            <span class="nx">amzn_wa</span><span class="p">.</span><span class="nx">IAP</span><span class="p">.</span><span class="nx">purchaseItem</span><span class="p">(</span><span class="nx">buttonName</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Handler functions that are called from the callbacks</span>

    <span class="c1">// purchaseItem will cause a purchase response with one receipt</span>
    <span class="kd">function</span> <span class="nx">onPurchaseResponse</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">purchaseRequestStatus</span> <span class="o">==</span> <span class="nx">amzn_wa</span><span class="p">.</span><span class="nx">IAP</span><span class="p">.</span><span class="nx">PurchaseStatus</span><span class="p">.</span><span class="nx">SUCCESSFUL</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">handleReceipt</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">receipt</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">purchaseRequestStatus</span> <span class="o">==</span> <span class="nx">amzn_wa</span><span class="p">.</span><span class="nx">IAP</span><span class="p">.</span><span class="nx">PurchaseStatus</span><span class="p">.</span><span class="nx">ALREADY_ENTITLED</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">amzn_wa</span><span class="p">.</span><span class="nx">IAP</span><span class="p">.</span><span class="nx">getPurchaseUpdates</span><span class="p">(</span><span class="nx">amzn_wa</span><span class="p">.</span><span class="nx">IAP</span><span class="p">.</span><span class="nx">Offset</span><span class="p">.</span><span class="nx">BEGINNING</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">refreshPageState</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// getPurchaseUpdates will return an array of receipts</span>
    <span class="kd">function</span> <span class="nx">onPurchaseUpdatesResponse</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">receipts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">handleReceipt</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">receipts</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="nx">refreshPageState</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// In either case, the contents of the receipt are handled in the same way</span>
    <span class="kd">function</span> <span class="nx">handleReceipt</span><span class="p">(</span><span class="nx">receipt</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">receipt</span><span class="p">.</span><span class="nx">sku</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">receipt</span><span class="p">.</span><span class="nx">sku</span> <span class="o">==</span> <span class="s2">"sample.redbutton"</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Entitlement</span>
            <span class="nx">hasRedButton</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">receipt</span><span class="p">.</span><span class="nx">sku</span> <span class="o">==</span> <span class="s2">"sample.greenbutton"</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Entitlement</span>
            <span class="nx">hasGreenButton</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Make the view (HTML) look like the model</span>

    <span class="kd">function</span> <span class="nx">refreshPageState</span><span class="p">()</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">button</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#theButton"</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">redButton</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#redButton"</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">greenButton</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#greenButton"</span><span class="p">);</span>

        <span class="nx">setClass</span><span class="p">(</span><span class="nx">redButton</span><span class="p">,</span> <span class="s2">"locked"</span><span class="p">,</span> <span class="o">!</span><span class="nx">hasRedButton</span><span class="p">);</span>
        <span class="nx">setClass</span><span class="p">(</span><span class="nx">greenButton</span><span class="p">,</span> <span class="s2">"locked"</span><span class="p">,</span> <span class="o">!</span><span class="nx">hasGreenButton</span><span class="p">);</span>

        <span class="nx">setClass</span><span class="p">(</span><span class="nx">redButton</span><span class="p">,</span> <span class="s2">"active"</span><span class="p">,</span> <span class="nx">activeButton</span> <span class="o">==</span> <span class="s2">"red"</span><span class="p">);</span>
        <span class="nx">setClass</span><span class="p">(</span><span class="nx">greenButton</span><span class="p">,</span> <span class="s2">"active"</span><span class="p">,</span>  <span class="nx">activeButton</span> <span class="o">==</span> <span class="s2">"green"</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">activeButton</span> <span class="o">!=</span> <span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">button</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">"background-color"</span><span class="p">,</span> <span class="nx">activeButton</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">button</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">"background-color"</span><span class="p">,</span> <span class="s2">"gray"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">setClass</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">className</span><span class="p">,</span> <span class="nx">condition</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">condition</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">element</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">className</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">element</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">className</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>[Next Step: Integrating Subscription Content Into Your App][iap-subscription-webapps]</p>




            </div>
        </div><!--/.container-->


    </div><!--/.page-container-->
    
    <div class="footertop">
    <div class="container">
        <div class="col-md-6">
            <p></p>
        </div>
        <div class="col-md-6">
            <ul class="bottom_ul">
        </div>
    </div>
</div>

<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-4 col-sm-6 footerleft ">
                <div class="logofooter"> About the Developer Portal</div>
                <p>The Amazon Developer Portal provides documentation for developers creating apps for the Amazon
                    appstore, including Alexa skills. Apps include streaming media apps, game apps, skills, and more. </p>

            </div>
            <div class="col-md-2 col-sm-6 paddingtop-bottom">
                <h6 class="heading7">Links</h6>
                <ul class="footer-ul">
                    <li><a class="noCrossRef" href="https://developer.amazon.com/"> Developer Portal</a></li>
                    <li><a class="noCrossRef" href="/index.html">Documentation Home</a></li>
                    <li class="noCrossRef"><a href="https://developer.amazon.com/support"> Support</a></li>
                    <li class="noCrossRef"><a href="https://aws.amazon.com/documentation/"> AWS docs</a></li>
                    <li class="noCrossRef"><a href="https://www.amazon.com/mobile-apps/b?ie=UTF8&node=2350149011"> Amazon Appstore</a></li>
                </ul>
            </div>

            <div class="col-md-3 col-sm-6 paddingtop-bottom">
                <h6 class="heading7">Amazon News</h6>
                <ul class="footer-ul">
                    <li class="noCrossRef"><a href="https://developer.amazon.com/blogs"> Blog</a></li>
                    <li class="noCrossRef"><a href="https://www.youtube.com/channel/UCT9ApARFgQJOeqD-ygmxnJQ"> YouTube</a></li>
                    <li class="noCrossRef"><a href="https://twitter.com/AmazonAppDev"> Twitter</a></li>
                    <li class="noCrossRef"><a href="http://phx.corporate-ir.net/phoenix.zhtml?p=irol-mediahome&c=176060"> Amazon Press Room</a></li>
                </ul>
            </div>

            <div class="col-md-3 col-sm-6 paddingtop-bottom">
                <h6 class="heading7">Forums</h6>
                <ul class="footer-ul">
                    <li class="noCrossRef"><a href="https://forums.developer.amazon.com/spaces/23/index.html"> Alexa Skills Kit</a></li>
                    <li class="noCrossRef"><a href="https://forums.developer.amazon.com/spaces/33/index.html"> Smart Home Skill API</a></li>
                    <li class="noCrossRef"><a href="https://forums.developer.amazon.com/spaces/38/index.html"> Alexa Voice Service</a></li>
                    <li class="noCrossRef"><a href="https://forums.developer.amazon.com/spaces/167/index.html"> Appstore</a></li>
                    <li class="noCrossRef"><a href="https://forums.developer.amazon.com/spaces/12/index.html"> Underground</a></li>
                    <li class="noCrossRef"><a href="https://forums.developer.amazon.com/spaces/166/index.html"> Fire Devices</a></li>
                    <li class="noCrossRef"><a href="https://forums.developer.amazon.com/spaces/61/index.html"> Dash</a></li>
                </ul>
            </div>
        </div>
    </div>
    </div>
</footer>
<!--subfooter start from here -->

<div class="copyright">
    <div class="container">
        <div class="col-md-12">
            <p>© 1996-2017, Amazon.com, Inc. or its affiliates</p>
        </div>
    </div>
</div>

    
    <!--scripts loaded here-->



</body>

</html>
